<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>huggingface基本使用教程 | 兼一书虫</title><meta name="keywords" content="huggingface,transformers"><meta name="author" content="narutohyc"><meta name="copyright" content="narutohyc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="huggingface基本使用教程">
<meta property="og:type" content="article">
<meta property="og:title" content="huggingface基本使用教程">
<meta property="og:url" content="https://study.hycbook.com/article/57912.html">
<meta property="og:site_name" content="兼一书虫">
<meta property="og:description" content="huggingface基本使用教程">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pic.hycbook.com/i/hexo/post_cover/%E8%95%BE%E5%A7%860.webp">
<meta property="article:published_time" content="2023-06-10T10:36:10.000Z">
<meta property="article:modified_time" content="2023-09-06T14:53:56.114Z">
<meta property="article:author" content="narutohyc">
<meta property="article:tag" content="huggingface">
<meta property="article:tag" content="transformers">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic.hycbook.com/i/hexo/post_cover/%E8%95%BE%E5%A7%860.webp"><link rel="shortcut icon" href="https://pic.hycbook.com/i//hexo/config_imgs/网站图标.webp"><link rel="canonical" href="https://study.hycbook.com/article/57912"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/manifest.json"/><meta name="msapplication-TileColor" content="#c6ff7a"/><link rel="apple-touch-icon" sizes="180x180" href="https://pic.hycbook.com/i//hexo/source/img/siteicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="https://pic.hycbook.com/i//hexo/source/img/siteicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="https://pic.hycbook.com/i//hexo/source/img/siteicon/favicon-16x16.png"/><link rel="mask-icon" href="https://pic.hycbook.com/i//hexo/source/img/siteicon/safari-pinned-tab.svg" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?68340394dfd808cea9826e8a57f87aa6";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":120,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":200,"languages":{"author":"作者: narutohyc","link":"链接: ","source":"来源: 兼一书虫","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'huggingface基本使用教程',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-09-06 22:53:56'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/hyc_udf.css"><link rel="stylesheet" href="/css/udf_css.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/mainColor/heoMainColor.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/404/404.css"><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><link href="https://cdn.bootcdn.net/ajax/libs/toastr.js/2.1.4/toastr.min.css" rel="stylesheet"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.hycbook.com/i/hexo/person_img/兼一头像.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">115</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">169</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-fangwu"></use></svg><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wenzhang1">             </use></svg><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-guidang">                   </use></svg><span> 归档</span></a></li><li><a class="site-page child" href="/categories"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-fenlei">                   </use></svg><span> 分类</span></a></li><li><a class="site-page child" href="/tags"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-biaoqian">                   </use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wenzhang1">             </use></svg><span> gitbook版</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://common.hycbook.com"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-guidang">                   </use></svg><span> common</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://python.hycbook.com"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-fenlei">                   </use></svg><span> python</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://dl.hycbook.com"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-biaoqian">                   </use></svg><span> 深度学习</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xuegao">             </use></svg><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-yinle">                   </use></svg><span> 音乐</span></a></li><li><a class="site-page child" href="/bangumis"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wodezhuifan">                   </use></svg><span> 追番</span></a></li><li><a class="site-page child" href="/gallery"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xiangce">                   </use></svg><span> 相册</span></a></li><li><a class="site-page child" href="/video"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-shipin">                   </use></svg><span> 视频</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/charts"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xigua"></use></svg><span> 统计图</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-suannai">             </use></svg><span> 网盘</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://pan.hycbook.com"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-guidang">                   </use></svg><span> 私月盘</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://share.hycbook.com"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhifengche">                   </use></svg><span> 共享盘</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhifeiji">             </use></svg><span> 导航</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/comments"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-TIFFANYSROOM_huaban">                   </use></svg><span> 留言板</span></a></li><li><a class="site-page child" href="/link"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-changyonglianjie">                   </use></svg><span> 友链</span></a></li><li><a class="site-page child" href="/about"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-aixin">                   </use></svg><span> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://pic.hycbook.com/i/hexo/post_imgs/蕾姆0.webp')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">兼一书虫</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-fangwu"></use></svg><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wenzhang1">             </use></svg><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-guidang">                   </use></svg><span> 归档</span></a></li><li><a class="site-page child" href="/categories"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-fenlei">                   </use></svg><span> 分类</span></a></li><li><a class="site-page child" href="/tags"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-biaoqian">                   </use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wenzhang1">             </use></svg><span> gitbook版</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://common.hycbook.com"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-guidang">                   </use></svg><span> common</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://python.hycbook.com"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-fenlei">                   </use></svg><span> python</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://dl.hycbook.com"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-biaoqian">                   </use></svg><span> 深度学习</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xuegao">             </use></svg><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-yinle">                   </use></svg><span> 音乐</span></a></li><li><a class="site-page child" href="/bangumis"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wodezhuifan">                   </use></svg><span> 追番</span></a></li><li><a class="site-page child" href="/gallery"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xiangce">                   </use></svg><span> 相册</span></a></li><li><a class="site-page child" href="/video"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-shipin">                   </use></svg><span> 视频</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/charts"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xigua"></use></svg><span> 统计图</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-suannai">             </use></svg><span> 网盘</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://pan.hycbook.com"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-guidang">                   </use></svg><span> 私月盘</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://share.hycbook.com"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhifengche">                   </use></svg><span> 共享盘</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhifeiji">             </use></svg><span> 导航</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/comments"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-TIFFANYSROOM_huaban">                   </use></svg><span> 留言板</span></a></li><li><a class="site-page child" href="/link"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-changyonglianjie">                   </use></svg><span> 友链</span></a></li><li><a class="site-page child" href="/about"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-aixin">                   </use></svg><span> 关于</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">huggingface基本使用教程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-06-10T10:36:10.000Z" title="发表于 2023-06-10 18:36:10">2023-06-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-09-06T14:53:56.114Z" title="更新于 2023-09-06 22:53:56">2023-09-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/deep-learning/">deep_learning</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">16.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>68分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title="huggingface基本使用教程"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/article/57912.html#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><hr>
<h1 id="huggingface"><a href="#huggingface" class="headerlink" title="huggingface"></a>huggingface</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://huggingface.co/docs">Hugging Face</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://huggingface.co/tasks">官网任务分类和示例</a></p>
</blockquote>
<p><code>Hugging Face</code>是一个知名的开源社区和公司，专注于自然语言处理(NLP)和机器学习(ML)领域。他们开发了许多流行的开源工具和库，使得构建和应用NLP模型更加便捷</p>
<p>Hugging face起初是一家总部位于纽约的聊天机器人初创服务商，他们本来打算创业做聊天机器人，然后在github上开源了一个Transformers库，虽然聊天机器人业务没搞起来，但是他们的这个库在机器学习社区迅速大火起来。目前已经共享了超100,000个预训练模型，10,000个数据集，变成了机器学习界的github</p>
<blockquote>
<p>在这里主要有以下大家需要的资源</p>
</blockquote>
<ol>
<li><p><strong>Datasets</strong>：数据集，以及数据集的下载地址</p>
</li>
<li><p><strong>Models</strong>：包括各种处理CV和NLP等任务的模型，上面模型都是可以免费获得</p>
<p>主要包括计算机视觉、自然语言处理、语音处理、多模态、表格处理、强化学习</p>
</li>
<li><p><strong>course</strong>：免费的nlp课程</p>
</li>
<li><p><strong>docs</strong>：文档</p>
</li>
</ol>
<blockquote>
<p>展开细节</p>
</blockquote>
<ul>
<li><strong>Computer Vision(计算机视觉任务)</strong>：包括lmage Classification(图像分类)，lmage Segmentation(图像分割)、zero-Shot lmage Classification(零样本图像分类)、lmage-to-Image(图像到图像的任务)、Unconditional lmage Generation(无条件图像生成)、Object Detection(目标检测)、Video Classification(视频分类)、Depth Estimation(深度估计，估计拍摄者距离图像各处的距离)</li>
<li><strong>Natural Language Processing(自然语言处理)</strong>：包括Translation(机器翻译)、Fill-Mask(填充掩码，预测句子中被遮掩的词)、Token Classification(词分类)、Sentence Similarity(句子相似度)、Question Answering(问答系统)，Summarization(总结，缩句)、Zero-Shot Classification (零样本分类)、Text Classification(文本分类)、Text2Text(文本到文本的生成)、Text Generation(文本生成)、Conversational(聊天)、Table Question Answer(表问答，1.预测表格中被遮掩单词2.数字推理，判断句子是否被表格数据支持)</li>
<li><strong>Audio(语音)</strong>：Automatic Speech Recognition(语音识别)、Audio Classification(语音分类)、Text-to-Speech(文本到语音的生成)、Audio-to-Audio(语音到语音的生成)、Voice Activity Detection(声音检测、检测识别出需要的声音部分)</li>
<li><strong>Multimodal(多模态)</strong>：Feature Extraction(特征提取)、Text-to-Image(文本到图像)、Visual Question Answering(视觉问答)、Image2Text(图像到文本)、Document Question Answering(文档问答)</li>
<li><strong>Tabular(表格)</strong>：Tabular Classification(表分类)、Tabular Regression(表回归)</li>
<li><strong>Reinforcement Learning(强化学习)</strong>：Reinforcement Learning(强化学习)、Robotics(机器人)</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><blockquote>
<p>安装transformers库</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install transformers</span><br></pre></td></tr></table></figure>
<h1 id="datasets"><a href="#datasets" class="headerlink" title="datasets"></a>datasets</h1><blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://zhuanlan.zhihu.com/p/582687507">HuggingFace datasets库总结</a></p>
</blockquote>
<h2 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h2><p>下面三个命令都用于安装Hugging Face的<code>datasets</code>库的不同配置</p>
<ol>
<li><code>pip install datasets</code>：这个命令安装的是<code>datasets</code>库的基本配置，它提供了对常见的自然语言处理(NLP)任务和数据集的支持，例如文本分类、命名实体识别、问答系统等。如果您只需要处理文本数据或进行常见的NLP任务，这个基本配置就足够了</li>
<li><code>pip install datasets[audio]</code>：这个命令安装的是<code>datasets</code>库的”audio”配置。它包含了对声音和音频数据集的支持，例如自动语音识别(ASR)和音频分类任务。如果您需要处理声音和音频数据，比如进行语音识别或音频分类，安装这个配置会提供相应的功能和数据集支持</li>
<li><code>pip install datasets[vision]</code>：这个命令安装的是<code>datasets</code>库的”vision”配置。它包含了对图像和计算机视觉任务的支持，例如图像分类、目标检测和分割等。如果您需要处理图像数据或进行计算机视觉任务，安装这个配置会提供相应的功能和数据集支持</li>
</ol>
<p>通过安装不同的配置，您可以选择仅安装您需要的功能和支持的任务类型，以减少库的安装和存储空间。根据您的具体需求，选择适合的配置进行安装即可</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装基础版</span></span><br><span class="line">pip install datasets</span><br><span class="line"><span class="comment"># 安装for声音</span></span><br><span class="line">pip install datasets[audio]</span><br><span class="line"><span class="comment"># 安装for图像</span></span><br><span class="line">pip install datasets[vision]</span><br></pre></td></tr></table></figure>
<h2 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h2><h3 id="视觉"><a href="#视觉" class="headerlink" title="视觉"></a>视觉</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset, Image</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">from</span> torchvision.transforms <span class="keyword">import</span> Compose, ColorJitter, ToTensor</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载数据集</span></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;beans&quot;</span>, split=<span class="string">&quot;train&quot;</span>)</span><br><span class="line"></span><br><span class="line">jitter = Compose(</span><br><span class="line">    [ColorJitter(brightness=<span class="number">0.5</span>, hue=<span class="number">0.5</span>), ToTensor()]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transforms</span>(<span class="params">examples</span>):</span><br><span class="line">    examples[<span class="string">&quot;pixel_values&quot;</span>] = [jitter(image.convert(<span class="string">&quot;RGB&quot;</span>)) <span class="keyword">for</span> image <span class="keyword">in</span> examples[<span class="string">&quot;image&quot;</span>]]</span><br><span class="line">    <span class="keyword">return</span> examples</span><br><span class="line"></span><br><span class="line">dataset = dataset.with_transform(transforms)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">collate_fn</span>(<span class="params">examples</span>):</span><br><span class="line">    images = []</span><br><span class="line">    labels = []</span><br><span class="line">    <span class="keyword">for</span> example <span class="keyword">in</span> examples:</span><br><span class="line">        images.append((example[<span class="string">&quot;pixel_values&quot;</span>]))</span><br><span class="line">        labels.append(example[<span class="string">&quot;labels&quot;</span>])</span><br><span class="line">        </span><br><span class="line">    pixel_values = torch.stack(images)</span><br><span class="line">    labels = torch.tensor(labels)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;pixel_values&quot;</span>: pixel_values, <span class="string">&quot;labels&quot;</span>: labels&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义DataLoader</span></span><br><span class="line">dataloader = DataLoader(dataset, collate_fn=collate_fn, batch_size=<span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<h3 id="nlp"><a href="#nlp" class="headerlink" title="nlp"></a>nlp</h3><p>使用 Hugging Face 提供的<code>datasets</code>库加载了<a target="_blank" rel="noopener external nofollow noreferrer" href="https://huggingface.co/datasets/glue/viewer/mrpc/test">GLUE</a>(General Language Understanding Evaluation)数据集中的MRPC(Microsoft Research Paraphrase Corpus)部分的训练集。这个数据集用于句子对的相似性判断任务</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoModelForSequenceClassification, AutoTokenizer</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;glue&quot;</span>, <span class="string">&quot;mrpc&quot;</span>, split=<span class="string">&quot;test&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># load a pretrained BERT model and its corresponding tokenizer from the 🤗 Transformers library.</span></span><br><span class="line">model = AutoModelForSequenceClassification.from_pretrained(<span class="string">&quot;bert-base-uncased&quot;</span>)</span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(<span class="string">&quot;bert-base-uncased&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">examples</span>):</span><br><span class="line">    <span class="keyword">return</span> tokenizer(examples[<span class="string">&quot;sentence1&quot;</span>], examples[<span class="string">&quot;sentence2&quot;</span>], truncation=<span class="literal">True</span>, padding=<span class="string">&quot;max_length&quot;</span>)</span><br><span class="line"></span><br><span class="line">dataset = dataset.<span class="built_in">map</span>(encode, batched=<span class="literal">True</span>)</span><br><span class="line">dataset[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;sentence1&#x27;</span>: <span class="string">&#x27;Amrozi accused his brother , whom he called &quot; the witness &quot; , of deliberately distorting his evidence .&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;sentence2&#x27;</span>: <span class="string">&#x27;Referring to him as only &quot; the witness &quot; , Amrozi accused his brother of deliberately distorting his evidence .&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;label&#x27;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="string">&#x27;idx&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;input_ids&#x27;</span>: array([  <span class="number">101</span>,  <span class="number">7277</span>,  <span class="number">2180</span>,  <span class="number">5303</span>,  <span class="number">4806</span>,  <span class="number">1117</span>,  <span class="number">1711</span>,   <span class="number">117</span>,  <span class="number">2292</span>, <span class="number">1119</span>,  <span class="number">1270</span>,   <span class="number">107</span>,  <span class="number">1103</span>,  <span class="number">7737</span>,   <span class="number">107</span>,   <span class="number">117</span>,  <span class="number">1104</span>,  <span class="number">9938</span>, <span class="number">4267</span>, <span class="number">12223</span>, <span class="number">21811</span>,  <span class="number">1117</span>,  <span class="number">2554</span>,   <span class="number">119</span>,   <span class="number">102</span>, <span class="number">11336</span>,  <span class="number">6732</span>, <span class="number">3384</span>,  <span class="number">1106</span>,  <span class="number">1140</span>,  <span class="number">1112</span>,  <span class="number">1178</span>,   <span class="number">107</span>,  <span class="number">1103</span>,  <span class="number">7737</span>,   <span class="number">107</span>, <span class="number">117</span>,  <span class="number">7277</span>,  <span class="number">2180</span>,  <span class="number">5303</span>,  <span class="number">4806</span>,  <span class="number">1117</span>,  <span class="number">1711</span>,  <span class="number">1104</span>,  <span class="number">9938</span>, <span class="number">4267</span>, <span class="number">12223</span>, <span class="number">21811</span>,  <span class="number">1117</span>,  <span class="number">2554</span>,   <span class="number">119</span>,   <span class="number">102</span>]),</span><br><span class="line"><span class="string">&#x27;token_type_ids&#x27;</span>: array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]),</span><br><span class="line"><span class="string">&#x27;attention_mask&#x27;</span>: array([<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>])&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#  Rename the label column to labels, which is the expected input name in BertForSequenceClassification</span></span><br><span class="line">dataset = dataset.<span class="built_in">map</span>(<span class="keyword">lambda</span> examples: &#123;<span class="string">&quot;labels&quot;</span>: examples[<span class="string">&quot;label&quot;</span>]&#125;, batched=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">dataset.set_format(<span class="built_in">type</span>=<span class="string">&quot;torch&quot;</span>, columns=[<span class="string">&quot;input_ids&quot;</span>, <span class="string">&quot;token_type_ids&quot;</span>, <span class="string">&quot;attention_mask&quot;</span>, <span class="string">&quot;labels&quot;</span>])</span><br><span class="line">dataloader = torch.utils.data.DataLoader(dataset, batch_size=<span class="number">32</span>)</span><br></pre></td></tr></table></figure>
<h2 id="加载数据集"><a href="#加载数据集" class="headerlink" title="加载数据集"></a>加载数据集</h2><blockquote>
<p>查看数据集描述</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset_builder</span><br><span class="line">ds_builder = load_dataset_builder(<span class="string">&quot;rotten_tomatoes&quot;</span>)</span><br><span class="line"></span><br><span class="line">ds_builder.info.description</span><br><span class="line">Movie Review Dataset. This <span class="keyword">is</span> a dataset of containing <span class="number">5</span>,<span class="number">331</span> positive <span class="keyword">and</span> <span class="number">5</span>,<span class="number">331</span> negative processed sentences <span class="keyword">from</span> Rotten Tomatoes movie reviews. This data was first used <span class="keyword">in</span> Bo Pang <span class="keyword">and</span> Lillian Lee, ``Seeing stars: Exploiting <span class="keyword">class</span> <span class="title class_">relationships</span> <span class="keyword">for</span> sentiment categorization <span class="keyword">with</span> respect to rating scales.<span class="string">&#x27;&#x27;</span>, Proceedings of the ACL, <span class="number">2005.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ds_builder.info.features</span><br><span class="line">&#123;<span class="string">&#x27;label&#x27;</span>: ClassLabel(num_classes=<span class="number">2</span>, names=[<span class="string">&#x27;neg&#x27;</span>, <span class="string">&#x27;pos&#x27;</span>], <span class="built_in">id</span>=<span class="literal">None</span>),</span><br><span class="line"> <span class="string">&#x27;text&#x27;</span>: Value(dtype=<span class="string">&#x27;string&#x27;</span>, <span class="built_in">id</span>=<span class="literal">None</span>)&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>加载数据集</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;rotten_tomatoes&quot;</span>, split=<span class="string">&quot;train&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>当一个数据集由多个文件(我们称之为<strong>分片</strong>)组成时，可以显著加快数据集的下载和准备步骤</p>
<p>您可以使用num_proc参数选择并行准备数据集时要使用的进程数。在这种情况下，每个进程被分配了一部分分片来进行准备</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line">oscar_afrikaans = load_dataset(<span class="string">&quot;oscar-corpus/OSCAR-2201&quot;</span>, <span class="string">&quot;af&quot;</span>, num_proc=<span class="number">8</span>)</span><br><span class="line">imagenet = load_dataset(<span class="string">&quot;imagenet-1k&quot;</span>, num_proc=<span class="number">8</span>)</span><br><span class="line">ml_librispeech_spanish = load_dataset(<span class="string">&quot;facebook/multilingual_librispeech&quot;</span>, <span class="string">&quot;spanish&quot;</span>, num_proc=<span class="number">8</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>查看数据集的分片名称，并加载指定的分片名称</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> get_dataset_split_names</span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line">get_dataset_split_names(<span class="string">&quot;rotten_tomatoes&quot;</span>)</span><br><span class="line">[<span class="string">&#x27;train&#x27;</span>, <span class="string">&#x27;validation&#x27;</span>, <span class="string">&#x27;test&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载指定分片</span></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;rotten_tomatoes&quot;</span>, split=<span class="string">&quot;train&quot;</span>)</span><br><span class="line"></span><br><span class="line">Dataset(&#123;</span><br><span class="line">    features: [<span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;label&#x27;</span>],</span><br><span class="line">    num_rows: <span class="number">8530</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 还可以这么写：</span></span><br><span class="line">train_test_ds = datasets.load_dataset(<span class="string">&quot;bookcorpus&quot;</span>, split=<span class="string">&quot;train+test&quot;</span>)</span><br><span class="line">train_10_20_ds = datasets.load_dataset(<span class="string">&quot;bookcorpus&quot;</span>, split=<span class="string">&quot;train[10:20]&quot;</span>)</span><br><span class="line">train_10pct_ds = datasets.load_dataset(<span class="string">&quot;bookcorpus&quot;</span>, split=<span class="string">&quot;train[:10%]&quot;</span>)</span><br><span class="line">train_10_80pct_ds = datasets.load_dataset(<span class="string">&quot;bookcorpus&quot;</span>, split=<span class="string">&quot;train[:10%]+train[-80%:]&quot;</span>)</span><br><span class="line">val_ds = datasets.load_dataset(<span class="string">&quot;bookcorpus&quot;</span>, split=[<span class="string">f&quot;train[<span class="subst">&#123;k&#125;</span>%:<span class="subst">&#123;k+<span class="number">10</span>&#125;</span>%]&quot;</span> <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">100</span>, <span class="number">10</span>)])</span><br><span class="line">train_ds = datasets.load_dataset(<span class="string">&quot;bookcorpus&quot;</span>, split=[<span class="string">f&quot;train[:<span class="subst">&#123;k&#125;</span>%]+train[<span class="subst">&#123;k+<span class="number">10</span>&#125;</span>%:]&quot;</span> <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">100</span>, <span class="number">10</span>)])</span><br><span class="line">train_50_52_ds = datasets.load_dataset(<span class="string">&quot;bookcorpus&quot;</span>, split=<span class="string">&quot;train[50%:52%]&quot;</span>)</span><br><span class="line">train_52_54_ds = datasets.load_dataset(<span class="string">&quot;bookcorpus&quot;</span>, split=<span class="string">&quot;train[52%:54%]&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 18 records, from 450 (included) to 468 (excluded).</span></span><br><span class="line">train_50_52pct1_ds = datasets.load_dataset(<span class="string">&quot;bookcorpus&quot;</span>, split=datasets.ReadInstruction(<span class="string">&quot;train&quot;</span>, from_=<span class="number">50</span>, to=<span class="number">52</span>, unit=<span class="string">&quot;%&quot;</span>, rounding=<span class="string">&quot;pct1_dropremainder&quot;</span>))</span><br><span class="line"><span class="comment"># 18 records, from 468 (included) to 486 (excluded).</span></span><br><span class="line">train_52_54pct1_ds = datasets.load_dataset(<span class="string">&quot;bookcorpus&quot;</span>, split=datasets.ReadInstruction(<span class="string">&quot;train&quot;</span>,from_=<span class="number">52</span>, to=<span class="number">54</span>, unit=<span class="string">&quot;%&quot;</span>, rounding=<span class="string">&quot;pct1_dropremainder&quot;</span>))</span><br><span class="line"><span class="comment"># Or equivalently:</span></span><br><span class="line">train_50_52pct1_ds = datasets.load_dataset(<span class="string">&quot;bookcorpus&quot;</span>, split=<span class="string">&quot;train[50%:52%](pct1_dropremainder)&quot;</span>)</span><br><span class="line">train_52_54pct1_ds = datasets.load_dataset(<span class="string">&quot;bookcorpus&quot;</span>, split=<span class="string">&quot;train[52%:54%](pct1_dropremainder)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载全部数据</span></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;rotten_tomatoes&quot;</span>)</span><br><span class="line">DatasetDict(&#123;</span><br><span class="line">    train: Dataset(&#123;</span><br><span class="line">        features: [<span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;label&#x27;</span>],</span><br><span class="line">        num_rows: <span class="number">8530</span></span><br><span class="line">    &#125;)</span><br><span class="line">    validation: Dataset(&#123;</span><br><span class="line">        features: [<span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;label&#x27;</span>],</span><br><span class="line">        num_rows: <span class="number">1066</span></span><br><span class="line">    &#125;)</span><br><span class="line">    test: Dataset(&#123;</span><br><span class="line">        features: [<span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;label&#x27;</span>],</span><br><span class="line">        num_rows: <span class="number">1066</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>查看数据集子集，一个数据下可能还有很多子数据集</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> get_dataset_config_names</span><br><span class="line"></span><br><span class="line">configs = get_dataset_config_names(<span class="string">&quot;PolyAI/minds14&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(configs)</span><br><span class="line"></span><br><span class="line">[<span class="string">&#x27;cs-CZ&#x27;</span>, <span class="string">&#x27;de-DE&#x27;</span>, <span class="string">&#x27;en-AU&#x27;</span>, <span class="string">&#x27;en-GB&#x27;</span>, <span class="string">&#x27;en-US&#x27;</span>, <span class="string">&#x27;es-ES&#x27;</span>, <span class="string">&#x27;fr-FR&#x27;</span>, <span class="string">&#x27;it-IT&#x27;</span>, <span class="string">&#x27;ko-KR&#x27;</span>, <span class="string">&#x27;nl-NL&#x27;</span>, <span class="string">&#x27;pl-PL&#x27;</span>, <span class="string">&#x27;pt-PT&#x27;</span>, <span class="string">&#x27;ru-RU&#x27;</span>, <span class="string">&#x27;zh-CN&#x27;</span>, <span class="string">&#x27;all&#x27;</span>]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>加载指定子数据集</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line">mindsFR = load_dataset(<span class="string">&quot;PolyAI/minds14&quot;</span>, <span class="string">&quot;fr-FR&quot;</span>, split=<span class="string">&quot;train&quot;</span>) <span class="comment"># 指定子数据集是fr-FR</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>指定数据集的文件, 避免load过多的数据</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data_files = &#123;<span class="string">&quot;validation&quot;</span>: <span class="string">&quot;en/c4-validation.*.json.gz&quot;</span>&#125;</span><br><span class="line">c4_validation = load_dataset(<span class="string">&quot;allenai/c4&quot;</span>, data_files=data_files, split=<span class="string">&quot;validation&quot;</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>load本地的json、csv文件等，可以load远程文件、sql等</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&#123;&quot;version&quot;: &quot;0.1.0&quot;,</span></span><br><span class="line"><span class="comment"># &quot;data&quot;: [&#123;&quot;a&quot;: 1, &quot;b&quot;: 2.0, &quot;c&quot;: &quot;foo&quot;, &quot;d&quot;: false&#125;,</span></span><br><span class="line"><span class="comment">#          &#123;&quot;a&quot;: 4, &quot;b&quot;: -5.5, &quot;c&quot;: null, &quot;d&quot;: true&#125;]</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line">dataset = load_dataset(<span class="string">&quot;json&quot;</span>, data_files=<span class="string">&quot;my_file.json&quot;</span>, field=<span class="string">&quot;data&quot;</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>通过python对象来创建dataset</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> Dataset</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字典方式</span></span><br><span class="line">my_dict = &#123;<span class="string">&quot;a&quot;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;</span><br><span class="line">dataset = Dataset.from_dict(my_dict)</span><br><span class="line"></span><br><span class="line"><span class="comment"># list方式</span></span><br><span class="line">my_list = [&#123;<span class="string">&quot;a&quot;</span>: <span class="number">1</span>&#125;, &#123;<span class="string">&quot;a&quot;</span>: <span class="number">2</span>&#125;, &#123;<span class="string">&quot;a&quot;</span>: <span class="number">3</span>&#125;]</span><br><span class="line">dataset = Dataset.from_list(my_list)</span><br><span class="line"></span><br><span class="line"><span class="comment"># pandas方式</span></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&quot;a&quot;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;)</span><br><span class="line">dataset = Dataset.from_pandas(df)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>load多个文本文件: 文本必须一行就是一条样本</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line">dataset = load_dataset(<span class="string">&quot;text&quot;</span>, data_files=&#123;<span class="string">&quot;train&quot;</span>: [<span class="string">&quot;my_text_1.txt&quot;</span>, <span class="string">&quot;my_text_2.txt&quot;</span>], <span class="string">&quot;test&quot;</span>: <span class="string">&quot;my_test_file.txt&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load from a directory</span></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;text&quot;</span>, data_dir=<span class="string">&quot;path/to/text/dataset&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>离线load: 将环境变量<code>HF_DATASETS_OFFLINE</code>设置为1以启用完全离线模式</p>
<h2 id="进阶加载数据集"><a href="#进阶加载数据集" class="headerlink" title="进阶加载数据集"></a>进阶加载数据集</h2><blockquote>
<p>从脚本加载数据集</p>
</blockquote>
<p>您可能在本地计算机上有一个🤗Datasets的加载脚本。在这种情况下，通过将以下路径之一传递给load_dataset()来加载数据集：</p>
<p>加载脚本文件的本地路径。 包含加载脚本文件的目录的本地路径(仅当脚本文件与目录具有相同的名称时)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dataset = load_dataset(<span class="string">&quot;path/to/local/loading_script/loading_script.py&quot;</span>, split=<span class="string">&quot;train&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># equivalent because the file has the same name as the directory</span></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;path/to/local/loading_script&quot;</span>, split=<span class="string">&quot;train&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>可以从Hub上下载加载脚本，并对其进行编辑以添加自己的修改。将数据集仓库下载到本地，以便加载脚本中相对路径引用的任何数据文件都可以被加载</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://huggingface.co/datasets/eli5</span><br></pre></td></tr></table></figure>
<p>在加载脚本上进行编辑后，通过将其本地路径传递给load_dataset()来加载它</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line">eli5 = load_dataset(<span class="string">&quot;path/to/local/eli5&quot;</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>csv+json方式</p>
</blockquote>
<p>数据集可以从存储在计算机上的本地文件和远程文件中加载。这些数据集很可能以csv、json、txt或parquet文件的形式存储。load_dataset()函数可以加载这些文件类型的数据集</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line"><span class="comment"># csv方式</span></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;csv&quot;</span>, data_files=<span class="string">&quot;my_file.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># json方式</span></span><br><span class="line"><span class="comment"># &#123;&quot;a&quot;: 1, &quot;b&quot;: 2.0, &quot;c&quot;: &quot;foo&quot;, &quot;d&quot;: false&#125;</span></span><br><span class="line"><span class="comment"># &#123;&quot;a&quot;: 4, &quot;b&quot;: -5.5, &quot;c&quot;: null, &quot;d&quot;: true&#125;</span></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;json&quot;</span>, data_files=<span class="string">&quot;my_file.json&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123;&quot;version&quot;: &quot;0.1.0&quot;,</span></span><br><span class="line"><span class="comment">#  &quot;data&quot;: [&#123;&quot;a&quot;: 1, &quot;b&quot;: 2.0, &quot;c&quot;: &quot;foo&quot;, &quot;d&quot;: false&#125;,</span></span><br><span class="line"><span class="comment">#           &#123;&quot;a&quot;: 4, &quot;b&quot;: -5.5, &quot;c&quot;: null, &quot;d&quot;: true&#125;]</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;json&quot;</span>, data_files=<span class="string">&quot;my_file.json&quot;</span>, field=<span class="string">&quot;data&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从http方式加载csv</span></span><br><span class="line">base_url = <span class="string">&quot;https://rajpurkar.github.io/SQuAD-explorer/dataset/&quot;</span></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;json&quot;</span>, data_files=&#123;<span class="string">&quot;train&quot;</span>: base_url + <span class="string">&quot;train-v1.1.json&quot;</span>, <span class="string">&quot;validation&quot;</span>: base_url + <span class="string">&quot;dev-v1.1.json&quot;</span>&#125;, field=<span class="string">&quot;data&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Parquet方式</span></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;parquet&quot;</span>, data_files=&#123;<span class="string">&#x27;train&#x27;</span>: <span class="string">&#x27;train.parquet&#x27;</span>, <span class="string">&#x27;test&#x27;</span>: <span class="string">&#x27;test.parquet&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">base_url = <span class="string">&quot;https://storage.googleapis.com/huggingface-nlp/cache/datasets/wikipedia/20200501.en/1.0.0/&quot;</span></span><br><span class="line">data_files = &#123;<span class="string">&quot;train&quot;</span>: base_url + <span class="string">&quot;wikipedia-train.parquet&quot;</span>&#125;</span><br><span class="line">wiki = load_dataset(<span class="string">&quot;parquet&quot;</span>, data_files=data_files, split=<span class="string">&quot;train&quot;</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>sql方式</p>
</blockquote>
<p>使用from_sql()方法可以通过指定连接到数据库的URI来读取数据库内容。您可以读取表名或执行查询操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> Dataset</span><br><span class="line"></span><br><span class="line">dataset = Dataset.from_sql(<span class="string">&quot;data_table_name&quot;</span>, con=<span class="string">&quot;sqlite:///sqlite_file.db&quot;</span>)</span><br><span class="line">dataset = Dataset.from_sql(<span class="string">&quot;SELECT text FROM table WHERE length(text) &gt; 100 LIMIT 10&quot;</span>, con=<span class="string">&quot;sqlite:///sqlite_file.db&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>For more details, check out the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://huggingface.co/docs/datasets/tabular_load#databases">how to load tabular datasets from SQL databases</a> guide.</p>
<h2 id="探索数据集"><a href="#探索数据集" class="headerlink" title="探索数据集"></a>探索数据集</h2><blockquote>
<p>下标</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一个样本</span></span><br><span class="line">dataset[<span class="number">0</span>]</span><br><span class="line"><span class="comment">#&#123;&#x27;label&#x27;: 1,</span></span><br><span class="line"><span class="comment"># &#x27;text&#x27;: &#x27;the rock is destined to be the 21st century\&#x27;s new &quot; conan &quot; and that he\&#x27;s going to make a splash even greater than arnold schwarzenegger , jean-claud van damme or steven segal .&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后一个样本</span></span><br><span class="line">dataset[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只取text列</span></span><br><span class="line">dataset[<span class="string">&quot;text&quot;</span>] <span class="comment"># 返回a list of 样本列</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一个样本text列</span></span><br><span class="line">dataset[<span class="number">0</span>][<span class="string">&quot;text&quot;</span>] <span class="comment"># 性能：dataset[0][&#x27;text&#x27;]比dataset[&#x27;text&#x27;][0]快2倍。</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>数据切片</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Get the first three rows</span></span><br><span class="line">dataset[:<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get rows between three and six</span></span><br><span class="line">dataset[<span class="number">3</span>:<span class="number">6</span>]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>迭代方式，streaming=True</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line">iterable_dataset = load_dataset(<span class="string">&quot;food101&quot;</span>, split=<span class="string">&quot;train&quot;</span>, streaming=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> example <span class="keyword">in</span> iterable_dataset:</span><br><span class="line">    <span class="built_in">print</span>(example)</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">&#123;<span class="string">&#x27;image&#x27;</span>: &lt;PIL.JpegImagePlugin.JpegImageFile image mode=RGB size=384x512 at <span class="number">0x7F0681F5C520</span>&gt;, <span class="string">&#x27;label&#x27;</span>: <span class="number">6</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get first three examples</span></span><br><span class="line"><span class="built_in">list</span>(iterable_dataset.take(<span class="number">3</span>))</span><br><span class="line">[&#123;<span class="string">&#x27;image&#x27;</span>: &lt;PIL.JpegImagePlugin.JpegImageFile image mode=RGB size=384x512 at <span class="number">0x7F7479DEE9D0</span>&gt;,</span><br><span class="line">  <span class="string">&#x27;label&#x27;</span>: <span class="number">6</span>&#125;,</span><br><span class="line"> &#123;<span class="string">&#x27;image&#x27;</span>: &lt;PIL.JpegImagePlugin.JpegImageFile image mode=RGB size=512x512 at <span class="number">0x7F7479DE8190</span>&gt;,</span><br><span class="line">  <span class="string">&#x27;label&#x27;</span>: <span class="number">6</span>&#125;,</span><br><span class="line"> &#123;<span class="string">&#x27;image&#x27;</span>: &lt;PIL.JpegImagePlugin.JpegImageFile image mode=RGB size=512x383 at <span class="number">0x7F7479DE8310</span>&gt;,</span><br><span class="line">  <span class="string">&#x27;label&#x27;</span>: <span class="number">6</span>&#125;]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>排序+shuffle+选择+filter+切分数据集+分片</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sort: 按某一列排序</span></span><br><span class="line">dataset.sort(<span class="string">&quot;label&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打乱</span></span><br><span class="line">shuffled_dataset = sorted_dataset.shuffle(seed=<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择</span></span><br><span class="line">small_dataset = dataset.select([<span class="number">0</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 匹配查找</span></span><br><span class="line">start_with_ar = dataset.<span class="built_in">filter</span>(<span class="keyword">lambda</span> example: example[<span class="string">&quot;sentence1&quot;</span>].startswith(<span class="string">&quot;Ar&quot;</span>))</span><br><span class="line"><span class="built_in">len</span>(start_with_ar)</span><br><span class="line">start_with_ar[<span class="string">&quot;sentence1&quot;</span>]</span><br><span class="line"><span class="comment"># 匹配查找：根据下标</span></span><br><span class="line">even_dataset = dataset.<span class="built_in">filter</span>(<span class="keyword">lambda</span> example, idx: idx % <span class="number">2</span> == <span class="number">0</span>, with_indices=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切分</span></span><br><span class="line">dataset.train_test_split(test_size=<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分片</span></span><br><span class="line"><span class="comment"># 数据集支持分片，将非常大的数据集划分为预定义数量的块。 在 shard() 中指定 num_shards 参数以确定要将数据集拆分成的分片数。 您还需要使用 index 参数提供要返回的分片。</span></span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line">datasets = load_dataset(<span class="string">&quot;imdb&quot;</span>, split=<span class="string">&quot;train&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(dataset)</span><br><span class="line">dataset.shard(num_shards=<span class="number">4</span>, index=<span class="number">0</span>) <span class="comment"># 四分之一</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>列重命名+移除列+转换格式+flatten</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> ClassLabel, Value</span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列重命名</span></span><br><span class="line">dataset = dataset.rename_column(<span class="string">&quot;sentence1&quot;</span>, <span class="string">&quot;sentenceA&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 去掉某一列</span></span><br><span class="line">dataset = dataset.remove_columns([<span class="string">&quot;sentence1&quot;</span>, <span class="string">&quot;sentence2&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换格式：一列或者多列</span></span><br><span class="line">new_features = dataset.features.copy()</span><br><span class="line">new_features[<span class="string">&quot;label&quot;</span>] = ClassLabel(names=[<span class="string">&quot;negative&quot;</span>, <span class="string">&quot;positive&quot;</span>])</span><br><span class="line">new_features[<span class="string">&quot;idx&quot;</span>] = Value(<span class="string">&quot;int64&quot;</span>)</span><br><span class="line">dataset = dataset.cast(new_features)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换格式：一列</span></span><br><span class="line">dataset = dataset.cast_column(<span class="string">&quot;audio&quot;</span>, Audio(sampling_rate=<span class="number">16000</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将某一列的key\value拉平</span></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;squad&quot;</span>, split=<span class="string">&quot;train&quot;</span>) <span class="comment"># ???</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>map转换</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocess <span class="keyword">import</span> set_start_method</span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">set_start_method(<span class="string">&quot;spawn&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># remove_columns 转换的同时去掉某一列</span></span><br><span class="line">updated_dataset = dataset.<span class="built_in">map</span>(<span class="keyword">lambda</span> example: &#123;<span class="string">&quot;new_sentence&quot;</span>: example[<span class="string">&quot;sentence1&quot;</span>]&#125;, remove_columns=[<span class="string">&quot;sentence1&quot;</span>])</span><br><span class="line">updated_dataset.column_names</span><br><span class="line"></span><br><span class="line"><span class="comment"># with_indices: 对下标处理</span></span><br><span class="line">updated_dataset = dataset.<span class="built_in">map</span>(<span class="keyword">lambda</span> example, idx: &#123;<span class="string">&quot;sentence2&quot;</span>: <span class="string">f&quot;<span class="subst">&#123;idx&#125;</span>: &quot;</span> + example[<span class="string">&quot;sentence2&quot;</span>]&#125;, with_indices=<span class="literal">True</span>)</span><br><span class="line">updated_dataset[<span class="string">&quot;sentence2&quot;</span>][:<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果您设置with_rank=True，map()也适用于进程的等级。 这类似于with_indices参数。 映射函数中的with_rank参数位于索引1之后(如果它已经存在)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gpu_computation</span>(<span class="params">example, rank</span>):</span><br><span class="line">    os.environ[<span class="string">&quot;CUDA_VISIBLE_DEVICES&quot;</span>] = <span class="built_in">str</span>(rank % torch.cuda.device_count())</span><br><span class="line">    <span class="comment"># Your big GPU call goes here</span></span><br><span class="line">    <span class="keyword">return</span> examples</span><br><span class="line">updated_dataset = dataset.<span class="built_in">map</span>(gpu_computation, with_rank=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多线程</span></span><br><span class="line">updated_dataset = dataset.<span class="built_in">map</span>(<span class="keyword">lambda</span> example, idx: &#123;<span class="string">&quot;sentence2&quot;</span>: <span class="string">f&quot;<span class="subst">&#123;idx&#125;</span>: &quot;</span> + example[<span class="string">&quot;sentence2&quot;</span>]&#125;, num_proc=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># batched</span></span><br><span class="line">chunked_dataset = dataset.<span class="built_in">map</span>(chunk_examples, batched=<span class="literal">True</span>, remove_columns=dataset.column_names)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据增强</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">augment_data</span>(<span class="params">examples</span>):</span><br><span class="line">    outputs = []</span><br><span class="line">    <span class="keyword">for</span> sentence <span class="keyword">in</span> examples[<span class="string">&quot;sentence1&quot;</span>]:</span><br><span class="line">        words = sentence.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        K = randint(<span class="number">1</span>, <span class="built_in">len</span>(words)-<span class="number">1</span>)</span><br><span class="line">        masked_sentence = <span class="string">&quot; &quot;</span>.join(words[:K]  + [mask_token] + words[K+<span class="number">1</span>:])</span><br><span class="line">        predictions = fillmask(masked_sentence)</span><br><span class="line">        augmented_sequences = [predictions[i][<span class="string">&quot;sequence&quot;</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">        outputs += [sentence] + augmented_sequences</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;data&quot;</span>: outputs&#125;</span><br><span class="line">augmented_dataset = smaller_dataset.<span class="built_in">map</span>(augment_data, batched=<span class="literal">True</span>, remove_columns=dataset.column_names, batch_size=<span class="number">8</span>)</span><br><span class="line">augmented_dataset[:<span class="number">9</span>][<span class="string">&quot;data&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理多split</span></span><br><span class="line">dataset = load_dataset(<span class="string">&#x27;glue&#x27;</span>, <span class="string">&#x27;mrpc&#x27;</span>)</span><br><span class="line">encoded_dataset = dataset.<span class="built_in">map</span>(<span class="keyword">lambda</span> examples: tokenizer(examples[<span class="string">&quot;sentence1&quot;</span>]), batched=<span class="literal">True</span>)</span><br><span class="line">encoded_dataset[<span class="string">&quot;train&quot;</span>][<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>合并+拼接数据集</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> concatenate_datasets, load_dataset</span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> Dataset</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载数据集</span></span><br><span class="line">bookcorpus = load_dataset(<span class="string">&quot;bookcorpus&quot;</span>, split=<span class="string">&quot;train&quot;</span>)</span><br><span class="line">wiki = load_dataset(<span class="string">&quot;wikipedia&quot;</span>, <span class="string">&quot;20220301.en&quot;</span>, split=<span class="string">&quot;train&quot;</span>)</span><br><span class="line">wiki = wiki.remove_columns([col <span class="keyword">for</span> col <span class="keyword">in</span> wiki.column_names <span class="keyword">if</span> col != <span class="string">&quot;text&quot;</span>])  <span class="comment"># only keep the &#x27;text&#x27; column</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> bookcorpus.features.<span class="built_in">type</span> == wiki.features.<span class="built_in">type</span></span><br><span class="line">bert_dataset = concatenate_datasets([bookcorpus, wiki])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以换concate的方向</span></span><br><span class="line">bookcorpus_ids = Dataset.from_dict(&#123;<span class="string">&quot;ids&quot;</span>: <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="built_in">len</span>(bookcorpus)))&#125;)</span><br><span class="line">bookcorpus_with_ids = concatenate_datasets([bookcorpus, bookcorpus_ids], axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>相互穿插</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按概率穿插</span></span><br><span class="line">seed = <span class="number">42</span></span><br><span class="line">probabilities = [<span class="number">0.3</span>, <span class="number">0.5</span>, <span class="number">0.2</span>]</span><br><span class="line">d1 = Dataset.from_dict(&#123;<span class="string">&quot;a&quot;</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]&#125;)</span><br><span class="line">d2 = Dataset.from_dict(&#123;<span class="string">&quot;a&quot;</span>: [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>]&#125;)</span><br><span class="line">d3 = Dataset.from_dict(&#123;<span class="string">&quot;a&quot;</span>: [<span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>]&#125;)</span><br><span class="line">dataset = interleave_datasets([d1, d2, d3], probabilities=probabilities, seed=seed)</span><br><span class="line">dataset[<span class="string">&quot;a&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按所有的样本都出现过一次后，马上停止</span></span><br><span class="line">d1 = Dataset.from_dict(&#123;<span class="string">&quot;a&quot;</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]&#125;)</span><br><span class="line">d2 = Dataset.from_dict(&#123;<span class="string">&quot;a&quot;</span>: [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>]&#125;)</span><br><span class="line">d3 = Dataset.from_dict(&#123;<span class="string">&quot;a&quot;</span>: [<span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>]&#125;)</span><br><span class="line">dataset = interleave_datasets([d1, d2, d3], stopping_strategy=<span class="string">&quot;all_exhausted&quot;</span>)</span><br><span class="line">dataset[<span class="string">&quot;a&quot;</span>]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>format</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dataset.set_format(<span class="built_in">type</span>=<span class="string">&quot;torch&quot;</span>, columns=[<span class="string">&quot;input_ids&quot;</span>, <span class="string">&quot;token_type_ids&quot;</span>, <span class="string">&quot;attention_mask&quot;</span>, <span class="string">&quot;label&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回一个新dataset</span></span><br><span class="line">dataset = dataset.with_format(<span class="built_in">type</span>=<span class="string">&quot;torch&quot;</span>, columns=[<span class="string">&quot;input_ids&quot;</span>, <span class="string">&quot;token_type_ids&quot;</span>, <span class="string">&quot;attention_mask&quot;</span>, <span class="string">&quot;label&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看</span></span><br><span class="line">dataset.<span class="built_in">format</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>保存</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_from_disk</span><br><span class="line"></span><br><span class="line">encoded_dataset.save_to_disk(<span class="string">&quot;path/of/my/dataset/directory&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从本地load上来</span></span><br><span class="line">reloaded_dataset = load_from_disk(<span class="string">&quot;path/of/my/dataset/directory&quot;</span>)</span><br><span class="line">encoded_dataset.to_csv(<span class="string">&quot;path/of/my/dataset.csv&quot;</span>)</span><br><span class="line">Dataset.to_json()</span><br></pre></td></tr></table></figure>
<h2 id="Preprocess处理"><a href="#Preprocess处理" class="headerlink" title="Preprocess处理"></a>Preprocess处理</h2><blockquote>
<p>文本处理：用transformers的tokenizer</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer</span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(<span class="string">&quot;bert-base-uncased&quot;</span>)</span><br><span class="line">dataset = load_dataset(<span class="string">&quot;rotten_tomatoes&quot;</span>, split=<span class="string">&quot;train&quot;</span>)</span><br><span class="line"></span><br><span class="line">tokenizer(dataset[<span class="number">0</span>][<span class="string">&quot;text&quot;</span>])</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;input_ids&#x27;</span>: [<span class="number">101</span>, <span class="number">1103</span>, <span class="number">2067</span>, <span class="number">1110</span>, <span class="number">17348</span>, <span class="number">1106</span>, <span class="number">1129</span>, <span class="number">1103</span>, <span class="number">6880</span>, <span class="number">1432</span>, <span class="number">112</span>, <span class="number">188</span>, <span class="number">1207</span>, <span class="number">107</span>, <span class="number">14255</span>, <span class="number">1389</span>, <span class="number">107</span>, <span class="number">1105</span>, <span class="number">1115</span>, <span class="number">1119</span>, <span class="number">112</span>, <span class="number">188</span>, <span class="number">1280</span>, <span class="number">1106</span>, <span class="number">1294</span>, <span class="number">170</span>, <span class="number">24194</span>, <span class="number">1256</span>, <span class="number">3407</span>, <span class="number">1190</span>, <span class="number">170</span>, <span class="number">11791</span>, <span class="number">5253</span>, <span class="number">188</span>, <span class="number">1732</span>, <span class="number">7200</span>, <span class="number">10947</span>, <span class="number">12606</span>, <span class="number">2895</span>, <span class="number">117</span>, <span class="number">179</span>, <span class="number">7766</span>, <span class="number">118</span>, <span class="number">172</span>, <span class="number">15554</span>, <span class="number">1181</span>, <span class="number">3498</span>, <span class="number">6961</span>, <span class="number">3263</span>, <span class="number">1137</span>, <span class="number">188</span>, <span class="number">1566</span>, <span class="number">7912</span>, <span class="number">14516</span>, <span class="number">6997</span>, <span class="number">119</span>, <span class="number">102</span>], </span><br><span class="line"> <span class="string">&#x27;token_type_ids&#x27;</span>: [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], </span><br><span class="line"> <span class="string">&#x27;attention_mask&#x27;</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]&#125;</span><br></pre></td></tr></table></figure>
<p>分词器返回一个包含三个项目的字典：</p>
<ul>
<li><strong>input_ids</strong>：表示文本中各个标记的数字</li>
<li><strong>token_type_ids</strong>：如果有多个序列，指示一个标记属于哪个序列</li>
<li><strong>attention_mask</strong>：指示一个标记是否应该被掩盖(masked)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset.set_format(<span class="built_in">type</span>=<span class="string">&quot;torch&quot;</span>, columns=[<span class="string">&quot;input_ids&quot;</span>, <span class="string">&quot;token_type_ids&quot;</span>, <span class="string">&quot;attention_mask&quot;</span>, <span class="string">&quot;labels&quot;</span>])</span><br></pre></td></tr></table></figure>
<blockquote>
<p>音频信号：重新采样音频信号</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoFeatureExtractor</span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset, Audio</span><br><span class="line"></span><br><span class="line">feature_extractor = AutoFeatureExtractor.from_pretrained(<span class="string">&quot;facebook/wav2vec2-base-960h&quot;</span>)</span><br><span class="line">dataset = load_dataset(<span class="string">&quot;PolyAI/minds14&quot;</span>, <span class="string">&quot;en-US&quot;</span>, split=<span class="string">&quot;train&quot;</span>)</span><br><span class="line"></span><br><span class="line">dataset[<span class="number">0</span>][<span class="string">&quot;audio&quot;</span>]</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;array&#x27;</span>: array([ <span class="number">0.</span>        ,  <span class="number">0.00024414</span>, -<span class="number">0.00024414</span>, ..., -<span class="number">0.00024414</span>,</span><br><span class="line">         <span class="number">0.</span>        ,  <span class="number">0.</span>        ], dtype=float32),</span><br><span class="line"> <span class="string">&#x27;path&#x27;</span>: <span class="string">&#x27;/root/.cache/huggingface/datasets/downloads/extracted/f14948e0e84be638dd7943ac36518a4cf3324e8b7aa331c5ab11541518e9368c/en-US~JOINT_ACCOUNT/602ba55abb1e6d0fbce92065.wav&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;sampling_rate&#x27;</span>: <span class="number">8000</span>&#125;</span><br></pre></td></tr></table></figure>
<p>MInDS-14数据集卡会告诉您采样率为8kHz</p>
<p>Wav2Vec2模型卡说它是在16kHz语音音频上采样的。 这意味着您需要对MInDS-14数据集进行上采样以匹配模型的采样率</p>
<p>使用cast_column()函数并在Audio功能中设置sampling_rate参数以对音频信号进行上采样。 当您现在调用音频列时，它会被解码并重新采样到16kHz：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dataset = dataset.cast_column(<span class="string">&quot;audio&quot;</span>, Audio(sampling_rate=<span class="number">16_000</span>))</span><br><span class="line">dataset[<span class="number">0</span>][<span class="string">&quot;audio&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加速：使用 map() 函数将整个数据集重新采样到16kHz</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">preprocess_function</span>(<span class="params">examples</span>):</span><br><span class="line">    audio_arrays = [x[<span class="string">&quot;array&quot;</span>] <span class="keyword">for</span> x <span class="keyword">in</span> examples[<span class="string">&quot;audio&quot;</span>]]</span><br><span class="line">    inputs = feature_extractor(</span><br><span class="line">        audio_arrays, sampling_rate=feature_extractor.sampling_rate, max_length=<span class="number">16000</span>, truncation=<span class="literal">True</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> inputs</span><br><span class="line"></span><br><span class="line">dataset = dataset.<span class="built_in">map</span>(preprocess_function, batched=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>图像增强</p>
</blockquote>
<p>在图像数据集中，最常见的预处理操作之一是<code>数据增强</code>(data augmentation)，这是一种在不改变数据含义的情况下对图像引入随机变化的过程</p>
<p>这可以包括改变图像的颜色属性或随机裁剪图像。您可以自由选择任何数据增强库，并且🤗Datasets将帮助您将数据增强应用到您的数据集中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoFeatureExtractor</span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset, Image</span><br><span class="line"><span class="keyword">from</span> torchvision.transforms <span class="keyword">import</span> RandomRotation</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">feature_extractor = AutoFeatureExtractor.from_pretrained(<span class="string">&quot;google/vit-base-patch16-224-in21k&quot;</span>)</span><br><span class="line">dataset = load_dataset(<span class="string">&quot;beans&quot;</span>, split=<span class="string">&quot;train&quot;</span>)</span><br><span class="line"></span><br><span class="line">rotate = RandomRotation(degrees=(<span class="number">0</span>, <span class="number">90</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transforms</span>(<span class="params">examples</span>):</span><br><span class="line">    examples[<span class="string">&quot;pixel_values&quot;</span>] = [rotate(image.convert(<span class="string">&quot;RGB&quot;</span>)) <span class="keyword">for</span> image <span class="keyword">in</span> examples[<span class="string">&quot;image&quot;</span>]]</span><br><span class="line">    <span class="keyword">return</span> examples</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用图像转换</span></span><br><span class="line">dataset.set_transform(transforms)</span><br><span class="line">dataset[<span class="number">0</span>][<span class="string">&quot;pixel_values&quot;</span>]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>label id对齐</p>
</blockquote>
<p>在Transformers库中，<strong>label id对齐</strong>(label ID alignment)通常指的是将标签与模型输出的预测结果对齐。当使用预训练模型进行分类或回归等任务时，通常需要将标签映射为模型期望的标签ID</p>
<p>具体来说，对于分类任务，常见的做法是将标签映射为整数标签ID。例如，如果有三个类别[“cat”, “dog”, “bird”]，可以将它们映射为[0, 1, 2]，并将模型的输出标签预测结果与这些标签ID进行对齐</p>
<p>对于回归任务，可能需要将连续值的标签进行离散化或归一化，并将其映射为标签ID。例如，将一个连续的目标值范围映射为一组离散的标签ID</p>
<p>在使用Transformers库进行训练或评估时，您需要确保标签与模型的输出结果具有相同的标签ID对齐，以便正确计算损失、评估指标和解码预测结果</p>
<p>需要注意的是，标签ID对齐的具体实现方式可能因任务和库的使用而有所不同。在具体的代码实现中，您可能需要根据您的数据集和模型设置进行相应的标签ID对齐操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">label2id = &#123;<span class="string">&quot;contradiction&quot;</span>: <span class="number">0</span>, <span class="string">&quot;neutral&quot;</span>: <span class="number">1</span>, <span class="string">&quot;entailment&quot;</span>: <span class="number">2</span>&#125;</span><br><span class="line">mnli = load_dataset(<span class="string">&quot;glue&quot;</span>, <span class="string">&quot;mnli&quot;</span>, split=<span class="string">&quot;train&quot;</span>)</span><br><span class="line">mnli_aligned = mnli.align_labels_with_mapping(label2id, <span class="string">&quot;label&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="构建数据集"><a href="#构建数据集" class="headerlink" title="构建数据集"></a>构建数据集</h2><p>如果您使用自己的数据，可能需要创建一个数据集。使用🤗Datasets创建数据集可以享受到该库的所有优势：快速加载和处理数据、流式处理大型数据集、内存映射等等。您可以使用🤗Datasets的低代码方法轻松快速地创建数据集，减少启动训练模型所需的时间。在许多情况下，只需将数据文件拖放到Hub上的数据集仓库中，就可以轻松完成</p>
<p>在本教程中，您将学习如何使用🤗Datasets的低代码方法创建各种类型的数据集：</p>
<ul>
<li>基于文件夹的构建器(Folder-based builders)，用于快速创建<strong>图像或音频数据集</strong></li>
<li>使用from_方法从本地文件创建数据集</li>
</ul>
<blockquote>
<p>基于文件夹的构建器</p>
</blockquote>
<p>有两个基于文件夹的构建器：<code>ImageFolder(图像文件夹构建器)</code>和<code>AudioFolder(音频文件夹构建器)</code></p>
<p>它们是低代码方法，可以快速创建包含数千个示例的图像、语音和音频数据集。它们非常适用于在扩展到更大的数据集之前，快速原型化计算机视觉和语音模型</p>
<p>基于文件夹的构建器会使用您的数据，并自动生成数据集的特征、划分和标签。具体来说：</p>
<ul>
<li>ImageFolder使用Image特征来解码图像文件。它支持许多图像扩展格式，例如jpg和png，还支持其他格式。您可以查看支持的图像扩展格式的完整列表</li>
<li>AudioFolder使用Audio特征来解码音频文件。它支持音频扩展格式，如wav和mp3，您可以查看支持的音频扩展格式的完整列表</li>
</ul>
<p>例如，如果您的图像数据集(对于音频数据集也是一样)存储如下所示：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pokemon/train/grass/bulbasaur.png</span><br><span class="line">pokemon/train/fire/charmander.png</span><br><span class="line">pokemon/train/water/squirtle.png</span><br><span class="line"></span><br><span class="line">pokemon/test/grass/ivysaur.png</span><br><span class="line">pokemon/test/fire/charmeleon.png</span><br><span class="line">pokemon/test/water/wartortle.png</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> ImageFolder</span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> AudioFolder</span><br><span class="line"></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;imagefolder&quot;</span>, data_dir=<span class="string">&quot;/path/to/pokemon&quot;</span>)</span><br><span class="line">dataset = load_dataset(<span class="string">&quot;audiofolder&quot;</span>, data_dir=<span class="string">&quot;/path/to/folder&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>数据集中可以包含有关数据集的其他信息，例如文本标题或转录，可以使用包含在数据集文件夹中的metadata.csv文件来进行存储</p>
<p>metadata文件需要有一个file_name列，将图像或音频文件与其相应的元数据进行关联</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">file_name, text</span><br><span class="line">bulbasaur.png, There is a plant seed on its back right from the day this Pokémon is born.</span><br><span class="line">charmander.png, It has a preference for hot things.</span><br><span class="line">squirtle.png, When it retracts its long neck into its shell, it squirts out water with vigorous force.</span><br></pre></td></tr></table></figure>
<p>To learn more about each of these folder-based builders, check out the and <a target="_blank" rel="noopener external nofollow noreferrer" href="https://huggingface.co/docs/datasets/image_dataset#imagefolder">ImageFolder</a> or <a target="_blank" rel="noopener external nofollow noreferrer" href="https://huggingface.co/docs/datasets/audio_dataset#audiofolder">AudioFolder</a> guides.</p>
<blockquote>
<p>基于文件的构建器</p>
</blockquote>
<p>使用 from_generator() 方法是从生成器创建数据集的最节省内存的方式，这是由于生成器的迭代行为。这在处理非常大的数据集时特别有用，因为数据集是逐步在磁盘上生成的，然后进行内存映射，这样可以避免将整个数据集加载到内存中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> Dataset</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen</span>():</span><br><span class="line">    <span class="keyword">yield</span> &#123;<span class="string">&quot;pokemon&quot;</span>: <span class="string">&quot;bulbasaur&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;grass&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">yield</span> &#123;<span class="string">&quot;pokemon&quot;</span>: <span class="string">&quot;squirtle&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;water&quot;</span>&#125;</span><br><span class="line">ds = Dataset.from_generator(gen)</span><br><span class="line">ds[<span class="number">0</span>]</span><br><span class="line">&#123;<span class="string">&quot;pokemon&quot;</span>: <span class="string">&quot;bulbasaur&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;grass&quot;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>基于生成器的IterableDataset需要使用for循环进行迭代，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> IterableDataset</span><br><span class="line">ds = IterableDataset.from_generator(gen)</span><br><span class="line"><span class="keyword">for</span> example <span class="keyword">in</span> ds:</span><br><span class="line">    <span class="built_in">print</span>(example)</span><br><span class="line">    </span><br><span class="line">&#123;<span class="string">&quot;pokemon&quot;</span>: <span class="string">&quot;bulbasaur&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;grass&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;pokemon&quot;</span>: <span class="string">&quot;squirtle&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;water&quot;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>使用from_dict()方法是从字典创建数据集的简单直接的方式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> Dataset</span><br><span class="line">ds = Dataset.from_dict(&#123;<span class="string">&quot;pokemon&quot;</span>: [<span class="string">&quot;bulbasaur&quot;</span>, <span class="string">&quot;squirtle&quot;</span>], <span class="string">&quot;type&quot;</span>: [<span class="string">&quot;grass&quot;</span>, <span class="string">&quot;water&quot;</span>]&#125;)</span><br><span class="line">ds[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&quot;pokemon&quot;</span>: <span class="string">&quot;bulbasaur&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;grass&quot;</span>&#125;</span><br></pre></td></tr></table></figure>
<h2 id="分享数据集"><a href="#分享数据集" class="headerlink" title="分享数据集"></a>分享数据集</h2><p>点击您的个人资料并选择新的数据集以创建一个新的数据集仓库。 为您的数据集选择一个名称，并选择它是一个公共数据集还是私有数据集。公共数据集对任何人可见，而私有数据集只能由您或您组织的成员查看</p>
<p>一旦您的数据集存储在Hub上，任何人都可以使用load_dataset()函数加载它：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;stevhliu/demo&quot;</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用Python进行上传</p>
</blockquote>
<p>喜欢以编程方式上传数据集的用户可以使用huggingface_hub库。该库允许用户从Python中与Hub进行交互</p>
<p>首先安装该库：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install huggingface_hub</span><br></pre></td></tr></table></figure>
<p>要在Hub上使用Python上传数据集，您需要登录到您的Hugging Face账户：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">huggingface-cli login</span><br></pre></td></tr></table></figure>
<p>使用push_to_hub()函数帮助您将文件添加、提交和推送到您的仓库：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;stevhliu/demo&quot;</span>)</span><br><span class="line"><span class="comment"># dataset = dataset.map(...)  # 在这里进行所有的数据处理</span></span><br><span class="line">dataset.push_to_hub(<span class="string">&quot;stevhliu/processed_demo&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>如果要将数据集设置为私有，请将private参数设置为True。该参数仅在首次创建仓库时有效</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset.push_to_hub(<span class="string">&quot;stevhliu/private_processed_demo&quot;</span>, private=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<h1 id="评估指标"><a href="#评估指标" class="headerlink" title="评估指标"></a>评估指标</h1><h2 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h2><p>一种用于轻松评估机器学习模型和数据集的库</p>
<p>只需一行代码，您就可以访问数十种不同领域(自然语言处理、计算机视觉、强化学习等)的评估方法</p>
<p>无论是在本地机器上还是在分布式训练环境中，您都可以以一种一致且可重复的方式评估您的模型</p>
<blockquote>
<p>安装</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install evaluate</span><br></pre></td></tr></table></figure>
<blockquote>
<p>测试</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&quot;import evaluate; print(evaluate.load(&#x27;exact_match&#x27;).compute(references=[&#x27;hello&#x27;], predictions=[&#x27;hello&#x27;]))&quot;</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;exact_match&#x27;</span>: 1.0&#125;</span><br></pre></td></tr></table></figure>
<h2 id="快速开始-1"><a href="#快速开始-1" class="headerlink" title="快速开始"></a>快速开始</h2><h3 id="指标种类"><a href="#指标种类" class="headerlink" title="指标种类"></a>指标种类</h3><blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://huggingface.co/evaluate-metric">Evaluate Metric卡片实例</a></p>
</blockquote>
<p>🤗Evaluate提供了广泛的评估工具。它涵盖了文本、计算机视觉、音频等多种形式，并提供了用于评估模型或数据集的工具。这些工具分为三个类别</p>
<p>评估类型 典型的机器学习流程涉及到不同方面的评估，对于每个方面，🤗 Evaluate都提供了相应的工具：</p>
<ul>
<li><strong>指标(Metric)</strong>：用于评估模型的性能，通常涉及模型的预测结果和一些真实标签。您可以在evaluate-metric中找到所有集成的指标</li>
<li><strong>比较(Comparison)</strong>：用于比较两个模型。可以通过将它们的预测结果与真实标签进行比较并计算它们的一致性来进行比较。您可以在evaluate-comparison中找到所有集成的比较方法</li>
<li><strong>测量(Measurement)</strong>：数据集和训练在其上的模型同样重要。通过测量可以研究数据集的特性。您可以在evaluate-measurement中找到所有集成的测量方法</li>
</ul>
<p>每个评估模块都作为一个Space存储在Hugging Face Hub上。它们提供了一个交互式小部件和一个文档卡片，用于记录其使用方法和限制</p>
<blockquote>
<p>评估工具之间的关系和区别</p>
</blockquote>
<p>Evaluate库中的<code>Metric(指标)</code>、<code>Comparison(比较)</code>和<code>Measurement(测量)</code>是三种不同的评估工具，用于评估机器学习模型和数据集。它们之间的关系和区别如下：</p>
<ol>
<li>Metric(指标)：<ul>
<li>用途：<strong>用于评估模型的性能</strong></li>
<li>具体含义：指标通过将模型的预测结果与真实标签进行比较来衡量模型的表现</li>
<li>示例：准确率、精确率、召回率、F1分数等</li>
<li>目的：提供了对模型性能的定量评估，帮助衡量模型在特定任务上的表现</li>
</ul>
</li>
<li>Comparison(比较)：<ul>
<li>用途：用于<strong>比较两个模型之间的差异</strong></li>
<li>具体含义：比较工具将两个模型的预测结果与真实标签进行对比，计算它们之间的一致性或差异程度</li>
<li>示例：一致性指标、相对误差等</li>
<li>目的：帮助评估不同模型之间的性能差异，找到更好的模型或进行模型选择</li>
</ul>
</li>
<li>Measurement(测量)：<ul>
<li>用途：用于<strong>研究数据集的属性和特性</strong></li>
<li>具体含义：测量工具用于对数据集进行分析，探索数据集的结构、分布、偏差等方面的信息</li>
<li>示例：数据集大小、样本分布、类别不平衡度等</li>
<li>目的：提供对数据集的详细了解，帮助了解数据集的特点和潜在问题</li>
</ul>
</li>
</ol>
<p>这三种评估工具在Evaluate库中各自独立，用于不同的评估目的。Metric用于衡量模型性能，Comparison用于比较不同模型之间的性能差异，Measurement用于研究和了解数据集的特性。通过使用这些工具，可以全面评估和理解机器学习模型和数据集的表现和特点</p>
<h3 id="指标加载"><a href="#指标加载" class="headerlink" title="指标加载"></a>指标加载</h3><blockquote>
<p>官方+社区 指标</p>
</blockquote>
<p>在使用Hugging Face的Evaluate库加载评估工具时，可以通过显式指定评估的类型来确保加载正确的工具。这可以防止名称冲突或混淆，确保您使用的是期望的评估工具</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> evaluate</span><br><span class="line"></span><br><span class="line">accuracy = evaluate.load(<span class="string">&quot;accuracy&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显式指定评估的类型</span></span><br><span class="line">word_length = evaluate.load(<span class="string">&quot;word_length&quot;</span>, module_type=<span class="string">&quot;measurement&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 社区指标</span></span><br><span class="line">element_count = evaluate.load(<span class="string">&quot;lvwerra/element_count&quot;</span>, module_type=<span class="string">&quot;measurement&quot;</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>查看可用的模块方法</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">evaluate.list_evaluation_modules(</span><br><span class="line">  module_type=<span class="string">&quot;comparison&quot;</span>,</span><br><span class="line">  include_community=<span class="literal">False</span>,</span><br><span class="line">  with_details=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">[&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;mcnemar&#x27;</span>, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;comparison&#x27;</span>, <span class="string">&#x27;community&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;likes&#x27;</span>: <span class="number">1</span>&#125;,</span><br><span class="line"> &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;exact_match&#x27;</span>, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;comparison&#x27;</span>, <span class="string">&#x27;community&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;likes&#x27;</span>: <span class="number">0</span>&#125;]</span><br></pre></td></tr></table></figure>
<h3 id="指标计算"><a href="#指标计算" class="headerlink" title="指标计算"></a>指标计算</h3><blockquote>
<p>计算指标</p>
</blockquote>
<p>当涉及到计算实际得分时，有两种主要的方法：</p>
<ul>
<li><p><strong>一体式计算(All-in-one)</strong>：通过一次性将所有必要的输入传递给compute()方法来计算得分</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">accuracy.compute(references=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>], predictions=[<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;accuracy&#x27;</span>: <span class="number">0.5</span>&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>逐步计算(Incremental)</strong>：通过使用EvaluationModule.add()或EvaluationModule.add_batch()将必要的输入逐步添加到模块中，然后在最后使用 EvaluationModule.compute()计算得分</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add的方式</span></span><br><span class="line"><span class="keyword">for</span> ref, pred <span class="keyword">in</span> <span class="built_in">zip</span>([<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>], [<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>]):</span><br><span class="line">    accuracy.add(references=ref, predictions=pred)</span><br><span class="line">accuracy.compute()</span><br><span class="line">&#123;<span class="string">&#x27;accuracy&#x27;</span>: <span class="number">0.5</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># add_batch的方式</span></span><br><span class="line"><span class="keyword">for</span> refs, preds <span class="keyword">in</span> <span class="built_in">zip</span>([[<span class="number">0</span>,<span class="number">1</span>],[<span class="number">0</span>,<span class="number">1</span>]], [[<span class="number">1</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">1</span>]]):</span><br><span class="line">    accuracy.add_batch(references=refs, predictions=preds)</span><br><span class="line">accuracy.compute()</span><br><span class="line">&#123;<span class="string">&#x27;accuracy&#x27;</span>: <span class="number">0.5</span>&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>在你需要以批量方式从模型中获取预测结果时特别有用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> model_inputs, gold_standards <span class="keyword">in</span> evaluation_dataset:</span><br><span class="line">    predictions = model(model_inputs)</span><br><span class="line">    metric.add_batch(references=gold_standards, predictions=predictions)</span><br><span class="line">metric.compute()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>分布式指标</p>
</blockquote>
<p>在分布式环境中计算指标可能会有些棘手。指标评估是在不同的数据子集上的单独Python进程或节点中执行的</p>
<p>通常情况下，当一个指标得分是可加的(<script type="math/tex">f(A \cup B) = f(A) + f(B)</script>)时，你可以使用分布式的reduce操作来收集每个数据子集的得分。但是当指标是非可加的(<script type="math/tex">f(A \cup B) \neq f(A) + f(B)</script>)时，情况就不那么简单了。例如，你不能将每个数据子集的F1分数相加作为最终的指标</p>
<p><strong>克服这个问题的常见方法是回退到单进程评估，但指标在单个GPU上进行评估，这会导致效率降低</strong></p>
<ol>
<li>🤗Evaluate通过仅在第一个节点上计算最终的指标来解决了这个问题</li>
<li><strong>预测结果和参考结果被分别计算并提供给每个节点的指标</strong>，这些结果暂时存储在Apache Arrow表中，避免了GPU或CPU内存的混乱</li>
<li>当你准备使用compute()计算最终指标时，第一个节点能够访问所有其他节点上存储的预测结果和参考结果。一旦它收集到所有的预测结果和参考结果，compute()将进行最终的指标评估</li>
</ol>
<p>这个解决方案使得🤗Evaluate能够在分布式设置中执行分布式预测，这对于提高评估速度非常重要。同时，你还可以使用复杂的非可加指标，而不浪费宝贵的GPU或CPU内存</p>
<blockquote>
<p>组合评估</p>
</blockquote>
<p>通常情况下，我们不仅想评估单个指标，而是想评估一系列不同的指标，以捕捉模型性能的不同方面</p>
<p>例如，对于分类问题，除了准确度外，通常还会计算F1分数、召回率和精确度，以便更好地了解模型的性能。当然，你可以加载一系列指标并依次调用它们。然而，一种更方便的方法是使用combine()函数将它们捆绑在一起：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">clf_metrics = evaluate.combine([<span class="string">&quot;accuracy&quot;</span>, <span class="string">&quot;f1&quot;</span>, <span class="string">&quot;precision&quot;</span>, <span class="string">&quot;recall&quot;</span>])</span><br><span class="line">clf_metrics.compute(predictions=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>], references=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&#x27;accuracy&#x27;</span>: <span class="number">0.667</span>,</span><br><span class="line">  <span class="string">&#x27;f1&#x27;</span>: <span class="number">0.667</span>,</span><br><span class="line">  <span class="string">&#x27;precision&#x27;</span>: <span class="number">1.0</span>,</span><br><span class="line">  <span class="string">&#x27;recall&#x27;</span>: <span class="number">0.5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>自动化评估</p>
</blockquote>
<p><strong>使用evaluate.evaluator()提供了自动化的评估功能</strong>，只需要一个模型、数据集和度量指标，与EvaluationModules中的度量指标相比，它不需要模型的预测结果。因此，使用给定的度量指标在数据集上评估模型更容易，因为推理过程是在内部处理的</p>
<p>为了实现这一点，它使用了transformers库中的pipeline抽象。然而，只要符合pipeline接口，你也可以使用自己的框架</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> pipeline</span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"><span class="keyword">from</span> evaluate <span class="keyword">import</span> evaluator</span><br><span class="line"><span class="keyword">import</span> evaluate</span><br></pre></td></tr></table></figure>
<p>为了使用evaluator进行评估，让我们加载一个基于IMDb训练的transformers pipeline（但你也可以传递自己的自定义推理类来适应任何遵循pipeline调用API的框架），并使用IMDb的测试集和准确度度量指标进行评估</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pipe = pipeline(<span class="string">&quot;text-classification&quot;</span>, model=<span class="string">&quot;lvwerra/distilbert-imdb&quot;</span>, device=<span class="number">0</span>)</span><br><span class="line">data = load_dataset(<span class="string">&quot;imdb&quot;</span>, split=<span class="string">&quot;test&quot;</span>).shuffle().select(<span class="built_in">range</span>(<span class="number">1000</span>))</span><br><span class="line">metric = evaluate.load(<span class="string">&quot;accuracy&quot;</span>)</span><br><span class="line"></span><br><span class="line">task_evaluator = evaluator(<span class="string">&quot;text-classification&quot;</span>)</span><br><span class="line">results = task_evaluator.compute(model_or_pipeline=pipe, data=data, metric=metric,</span><br><span class="line">                       label_mapping=&#123;<span class="string">&quot;NEGATIVE&quot;</span>: <span class="number">0</span>, <span class="string">&quot;POSITIVE&quot;</span>: <span class="number">1</span>&#125;,)</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;accuracy&#x27;</span>: <span class="number">0.934</span>&#125;</span><br></pre></td></tr></table></figure>
<p>仅仅计算度量指标的值通常还不足以知道一个模型是否显著优于另一个模型。通过使用<code>自助法(bootstrapping)</code>，evaluate计算置信区间和标准误差，这有助于估计分数的稳定性</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">results = <span class="built_in">eval</span>.compute(model_or_pipeline=pipe, data=data, metric=metric,</span><br><span class="line">                       label_mapping=&#123;<span class="string">&quot;NEGATIVE&quot;</span>: <span class="number">0</span>, <span class="string">&quot;POSITIVE&quot;</span>: <span class="number">1</span>&#125;,</span><br><span class="line">                       strategy=<span class="string">&quot;bootstrap&quot;</span>, n_resamples=<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;accuracy&#x27;</span>:</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&#x27;confidence_interval&#x27;</span>: (<span class="number">0.906</span>, <span class="number">0.9406749892841922</span>),</span><br><span class="line">      <span class="string">&#x27;standard_error&#x27;</span>: <span class="number">0.00865213251082787</span>,</span><br><span class="line">      <span class="string">&#x27;score&#x27;</span>: <span class="number">0.923</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>评估器期望数据输入具有”text”和”label”列。如果您的数据集不同，可以使用关键字参数input_column=”text”和label_column=”label”来提供列名</p>
<p>目前只支持”text-classification”任务，将来可能会添加更多的任务类型</p>
<h3 id="结果存储"><a href="#结果存储" class="headerlink" title="结果存储"></a>结果存储</h3><blockquote>
<p>评估结果save和push</p>
</blockquote>
<p>保存和分享评估结果是一个重要的步骤。我们提供evaluate.save()函数来方便地保存指标结果。你可以传递一个特定的文件名或目录。在后一种情况下，结果将保存在一个带有自动创建的文件名的文件中</p>
<p>除了目录或文件名，该函数还接受任意的键值对作为输入，并将它们存储在一个JSON文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">result = accuracy.compute(references=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>], predictions=[<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">hyperparams = &#123;<span class="string">&quot;model&quot;</span>: <span class="string">&quot;bert-base-uncased&quot;</span>&#125;</span><br><span class="line">evaluate.save(<span class="string">&quot;./results/&quot;</span>, experiment=<span class="string">&quot;run 42&quot;</span>, **result, **hyperparams)</span><br><span class="line"></span><br><span class="line">PosixPath(<span class="string">&#x27;results/result-2022_05_30-22_09_11.json&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># result-2022_05_30-22_09_11.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;experiment&quot;</span>: <span class="string">&quot;run 42&quot;</span>,</span><br><span class="line">    <span class="string">&quot;accuracy&quot;</span>: <span class="number">0.5</span>,</span><br><span class="line">    <span class="string">&quot;model&quot;</span>: <span class="string">&quot;bert-base-uncased&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_timestamp&quot;</span>: <span class="string">&quot;2022-05-30T22:09:11.959469&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_git_commit_hash&quot;</span>: <span class="string">&quot;123456789abcdefghijkl&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_evaluate_version&quot;</span>: <span class="string">&quot;0.1.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_python_version&quot;</span>: <span class="string">&quot;3.9.12 (main, Mar 26 2022, 15:51:15) \n[Clang 13.1.6 (clang-1316.0.21.2)]&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_interpreter_path&quot;</span>: <span class="string">&quot;/Users/leandro/git/evaluate/env/bin/python&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>除了指定的字段，它还包含有用的系统信息，用于重现结果，你还应该将它们报告到模型在Hub上的存储库中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">evaluate.push_to_hub(</span><br><span class="line">  model_id=<span class="string">&quot;huggingface/gpt2-wikitext2&quot;</span>,  <span class="comment"># model repository on hub</span></span><br><span class="line">  metric_value=<span class="number">0.5</span>,                       <span class="comment"># metric value</span></span><br><span class="line">  metric_type=<span class="string">&quot;bleu&quot;</span>,                     <span class="comment"># metric name, e.g. accuracy.name</span></span><br><span class="line">  metric_name=<span class="string">&quot;BLEU&quot;</span>,                     <span class="comment"># pretty name which is displayed</span></span><br><span class="line">  dataset_type=<span class="string">&quot;wikitext&quot;</span>,                <span class="comment"># dataset name on the hub</span></span><br><span class="line">  dataset_name=<span class="string">&quot;WikiText&quot;</span>,                <span class="comment"># pretty name</span></span><br><span class="line">  dataset_split=<span class="string">&quot;test&quot;</span>,                   <span class="comment"># dataset split used</span></span><br><span class="line">  task_type=<span class="string">&quot;text-generation&quot;</span>,            <span class="comment"># task id, see https://github.com/huggingface/datasets/blob/master/src/datasets/utils/resources/tasks.json</span></span><br><span class="line">  task_name=<span class="string">&quot;Text Generation&quot;</span>             <span class="comment"># pretty name for task</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上传自己的指标<a target="_blank" rel="noopener external nofollow noreferrer" href="https://huggingface.co/docs/evaluate/main/en/creating_and_sharing">Creating and sharing a new evaluation</a></p>
</blockquote>
<h3 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h3><p>当比较多个模型时，仅通过查看它们的得分往往很难发现它们之间的差异。而且通常情况下，并没有一个单一的最佳模型，而是在准确性和延迟等方面存在着权衡，因为较大的模型可能具有更好的性能但也更慢。我们正在逐步添加不同的可视化方法，例如绘图，以便更轻松地选择适合特定用例的最佳模型。</p>
<p>例如，如果您有多个模型的结果列表（以字典形式），您可以将它们传递给radar_plot()函数进行可视化：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> evaluate</span><br><span class="line"><span class="keyword">from</span> evaluate.visualization <span class="keyword">import</span> radar_plot</span><br><span class="line"></span><br><span class="line">data = [</span><br><span class="line">   &#123;<span class="string">&quot;accuracy&quot;</span>: <span class="number">0.99</span>, <span class="string">&quot;precision&quot;</span>: <span class="number">0.8</span>, <span class="string">&quot;f1&quot;</span>: <span class="number">0.95</span>, <span class="string">&quot;latency_in_seconds&quot;</span>: <span class="number">33.6</span>&#125;,</span><br><span class="line">   &#123;<span class="string">&quot;accuracy&quot;</span>: <span class="number">0.98</span>, <span class="string">&quot;precision&quot;</span>: <span class="number">0.87</span>, <span class="string">&quot;f1&quot;</span>: <span class="number">0.91</span>, <span class="string">&quot;latency_in_seconds&quot;</span>: <span class="number">11.2</span>&#125;,</span><br><span class="line">   &#123;<span class="string">&quot;accuracy&quot;</span>: <span class="number">0.98</span>, <span class="string">&quot;precision&quot;</span>: <span class="number">0.78</span>, <span class="string">&quot;f1&quot;</span>: <span class="number">0.88</span>, <span class="string">&quot;latency_in_seconds&quot;</span>: <span class="number">87.6</span>&#125;, </span><br><span class="line">   &#123;<span class="string">&quot;accuracy&quot;</span>: <span class="number">0.88</span>, <span class="string">&quot;precision&quot;</span>: <span class="number">0.78</span>, <span class="string">&quot;f1&quot;</span>: <span class="number">0.81</span>, <span class="string">&quot;latency_in_seconds&quot;</span>: <span class="number">101.6</span>&#125;</span><br><span class="line">   ]</span><br><span class="line">model_names = [<span class="string">&quot;Model 1&quot;</span>, <span class="string">&quot;Model 2&quot;</span>, <span class="string">&quot;Model 3&quot;</span>, <span class="string">&quot;Model 4&quot;</span>]</span><br><span class="line">plot = radar_plot(data=data, model_names=model_names)</span><br><span class="line">plot.show()</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.hycbook.com/i/hexo/bk_resources/deep_learning/huggingface基本使用教程/模型比较指标图.webp" alt="模型比较指标图"></p>
<h3 id="选择合适指标"><a href="#选择合适指标" class="headerlink" title="选择合适指标"></a>选择合适指标</h3><p>评估指标可以分为三个高级类别：</p>
<ul>
<li><p><strong>通用指标</strong>：适用于各种情况和数据集的指标，例如精确度和准确度</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">precision_metric = evaluate.load(<span class="string">&quot;precision&quot;</span>)</span><br><span class="line">results = precision_metric.compute(references=[<span class="number">0</span>, <span class="number">1</span>], predictions=[<span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(results)</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;precision&#x27;</span>: <span class="number">1.0</span>&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>任务特定指标</strong>：仅适用于特定任务的指标，例如机器翻译(通常使用BLEU或ROUGE指标进行评估)或命名实体识别(通常使用seqeval进行评估)</p>
</li>
<li><p><strong>数据集特定指标</strong>：旨在衡量模型在特定基准数据集上的性能，例如GLUE基准测试具有专门的评估指标</p>
</li>
</ul>
<h1 id="transformers"><a href="#transformers" class="headerlink" title="transformers"></a>transformers</h1><h2 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h2><blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://huggingface.co/docs/transformers/v4.30.0/en/task_summary">What 🤗 Transformers can do</a></p>
</blockquote>
<p>🤗 Transformers提供了API和工具，可轻松下载和训练最先进的预训练模型。使用预训练模型可以减少计算成本、碳足迹，并节省从头开始训练模型所需的时间和资源。这些模型支持不同领域的常见任务，包括：</p>
<ul>
<li>📝 自然语言处理：文本分类、命名实体识别、问答系统、语言建模、摘要生成、翻译、多项选择和文本生成</li>
<li>🖼️ 计算机视觉：图像分类、目标检测和分割</li>
<li>🗣️ 音频：自动语音识别和音频分类</li>
<li>🐙 多模态：表格问答、光学字符识别、从扫描文档中提取信息、视频分类和视觉问答</li>
</ul>
<p>🤗 Transformers支持在PyTorch、TensorFlow和JAX之间进行框架互操作。这提供了在模型的不同阶段使用不同框架的灵活性；可以在一个框架中用三行代码训练模型，然后在另一个框架中加载模型进行推理。模型还可以导出为ONNX和TorchScript等格式，以便在生产环境中进行部署</p>
<h2 id="安装-3"><a href="#安装-3" class="headerlink" title="安装"></a>安装</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install transformers datasets</span><br></pre></td></tr></table></figure>
<h2 id="快速开始-2"><a href="#快速开始-2" class="headerlink" title="快速开始"></a>快速开始</h2><h3 id="Pipeline"><a href="#Pipeline" class="headerlink" title="Pipeline"></a>Pipeline</h3><p>pipeline()是使用预训练模型进行推理的最简单和最快捷的方法。您可以直接使用pipeline()进行许多任务的推理，涵盖了不同的模态，下表列出了其中一些任务</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><strong>Task</strong></th>
<th><strong>Description</strong></th>
<th><strong>Modality</strong></th>
<th><strong>Pipeline identifier</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Text classification</td>
<td>assign a label to a given sequence of text</td>
<td>NLP</td>
<td>pipeline(task=“sentiment-analysis”)</td>
</tr>
<tr>
<td>Text generation</td>
<td>generate text given a prompt</td>
<td>NLP</td>
<td>pipeline(task=“text-generation”)</td>
</tr>
<tr>
<td>Summarization</td>
<td>generate a summary of a sequence of text or document</td>
<td>NLP</td>
<td>pipeline(task=“summarization”)</td>
</tr>
<tr>
<td>Image classification</td>
<td>assign a label to an image</td>
<td>CV</td>
<td>pipeline(task=“image-classification”)</td>
</tr>
<tr>
<td>Image segmentation</td>
<td>assign a label to each individual pixel of an image (supports semantic, panoptic, and instance segmentation)</td>
<td>CV</td>
<td>pipeline(task=“image-segmentation”)</td>
</tr>
<tr>
<td>Object detection</td>
<td>predict the bounding boxes and classes of objects in an image</td>
<td>CV</td>
<td>pipeline(task=“object-detection”)</td>
</tr>
<tr>
<td>Audio classification</td>
<td>assign a label to some audio data</td>
<td>Audio</td>
<td>pipeline(task=“audio-classification”)</td>
</tr>
<tr>
<td>Automatic speech recognition</td>
<td>transcribe speech into text</td>
<td>Audio</td>
<td>pipeline(task=“automatic-speech-recognition”)</td>
</tr>
<tr>
<td>Visual question answering</td>
<td>answer a question about the image, given an image and a question</td>
<td>Multimodal</td>
<td>pipeline(task=“vqa”)</td>
</tr>
<tr>
<td>Document question answering</td>
<td>answer a question about a document, given an image and a question</td>
<td>Multimodal</td>
<td>pipeline(task=“document-question-answering”)</td>
</tr>
<tr>
<td>Image captioning</td>
<td>generate a caption for a given image</td>
<td>Multimodal</td>
<td>pipeline(task=“image-to-text”)</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>基本使用</p>
</blockquote>
<p>首先，通过创建pipeline()的实例并指定要使用的任务，开始使用它。在本指南中，我们以情感分析的pipeline()为例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> pipeline</span><br><span class="line"></span><br><span class="line">classifier = pipeline(<span class="string">&quot;sentiment-analysis&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>pipeline()会下载并缓存用于情感分析的默认预训练模型和分词器。现在，您可以在目标文本上使用分类器了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">classifier(<span class="string">&quot;We are very happy to show you the 🤗 Transformers library.&quot;</span>)</span><br><span class="line"></span><br><span class="line">[&#123;<span class="string">&#x27;label&#x27;</span>: <span class="string">&#x27;POSITIVE&#x27;</span>, <span class="string">&#x27;score&#x27;</span>: <span class="number">0.9998</span>&#125;]</span><br></pre></td></tr></table></figure>
<p>如果您有多个输入，请将输入作为列表传递给pipeline()，以返回一个字典列表</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">results = classifier([<span class="string">&quot;We are very happy to show you the 🤗 Transformers library.&quot;</span>, <span class="string">&quot;We hope you don&#x27;t hate it.&quot;</span>])</span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;label: <span class="subst">&#123;result[<span class="string">&#x27;label&#x27;</span>]&#125;</span>, with score: <span class="subst">&#123;<span class="built_in">round</span>(result[<span class="string">&#x27;score&#x27;</span>], <span class="number">4</span>)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">label: POSITIVE, <span class="keyword">with</span> score: <span class="number">0.9998</span></span><br><span class="line">label: NEGATIVE, <span class="keyword">with</span> score: <span class="number">0.5309</span></span><br></pre></td></tr></table></figure>
<p>pipeline()还可以对任何您喜欢的任务迭代整个数据集。在这个例子中，让我们选择自动语音识别作为我们的任务</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> pipeline</span><br><span class="line"></span><br><span class="line">speech_recognizer = pipeline(<span class="string">&quot;automatic-speech-recognition&quot;</span>, model=<span class="string">&quot;facebook/wav2vec2-base-960h&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>加载您想要迭代的音频数据集(有关更多详细信息，请参阅🤗 Datasets快速入门)。例如，加载MInDS-14数据集：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset, Audio</span><br><span class="line"></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;PolyAI/minds14&quot;</span>, name=<span class="string">&quot;en-US&quot;</span>, split=<span class="string">&quot;train&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>您需要确保数据集的采样率与facebook/wav2vec2-base-960h 训练时使用的采样率相匹配</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset = dataset.cast_column(<span class="string">&quot;audio&quot;</span>, Audio(sampling_rate=speech_recognizer.feature_extractor.sampling_rate))</span><br></pre></td></tr></table></figure>
<p>调用”audio”列时，音频文件会自动加载和重新采样。从前四个样本中提取原始波形数组，并将其作为列表传递给pipeline：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">result = speech_recognizer(dataset[:<span class="number">4</span>][<span class="string">&quot;audio&quot;</span>])</span><br><span class="line"><span class="built_in">print</span>([d[<span class="string">&quot;text&quot;</span>] <span class="keyword">for</span> d <span class="keyword">in</span> result])</span><br><span class="line"></span><br><span class="line">[<span class="string">&#x27;I WOULD LIKE TO SET UP A JOINT ACCOUNT WITH MY PARTNER HOW DO I PROCEED WITH DOING THAT&#x27;</span>, <span class="string">&quot;FONDERING HOW I&#x27;D SET UP A JOIN TO HELL T WITH MY WIFE AND WHERE THE AP MIGHT BE&quot;</span>, <span class="string">&quot;I I&#x27;D LIKE TOY SET UP A JOINT ACCOUNT WITH MY PARTNER I&#x27;M NOT SEEING THE OPTION TO DO IT ON THE APSO I CALLED IN TO GET SOME HELP CAN I JUST DO IT OVER THE PHONE WITH YOU AND GIVE YOU THE INFORMATION OR SHOULD I DO IT IN THE AP AN I&#x27;M MISSING SOMETHING UQUETTE HAD PREFERRED TO JUST DO IT OVER THE PHONE OF POSSIBLE THINGS&quot;</span>, <span class="string">&#x27;HOW DO I FURN A JOINA COUT&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>对于输入较大的更大数据集(如语音或视觉数据)，您可以将生成器传递给pipeline，而不是将其作为列表加载到内存中</p>
<p>在pipeline中使用其他模型和分词器pipeline()可以适应Hub中的任何模型，这使得对pipeline()进行其他用途的调整变得容易</p>
<p>例如，如果您想要一个能够处理法语文本的模型，请使用Hub上的标签来过滤合适的模型。通过对过滤结果进行排序，您可以获得一个针对法语文本进行情感分析的多语言BERT模型</p>
<blockquote>
<p>在pipeline中使用另一个模型和分词器</p>
</blockquote>
<p>pipeline()可以适应Hub中的任何模型，这使得将pipeline()适应其他用例变得容易</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer, AutoModelForSequenceClassification</span><br><span class="line"></span><br><span class="line">model_name = <span class="string">&quot;nlptown/bert-base-multilingual-uncased-sentiment&quot;</span></span><br><span class="line">model = AutoModelForSequenceClassification.from_pretrained(model_name)</span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(model_name)</span><br><span class="line"></span><br><span class="line">classifier = pipeline(<span class="string">&quot;sentiment-analysis&quot;</span>, model=model, tokenizer=tokenizer)</span><br><span class="line">classifier(<span class="string">&quot;Nous sommes très heureux de vous présenter la bibliothèque 🤗 Transformers.&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="AutoClass"><a href="#AutoClass" class="headerlink" title="AutoClass"></a>AutoClass</h3><p>AutoClass是一种快捷方式，它可以根据模型的名称或路径自动获取预训练模型的架构。您只需要选择与您的任务相匹配的AutoClass和相应的预处理类</p>
<h4 id="AutoTokenizer"><a href="#AutoTokenizer" class="headerlink" title="AutoTokenizer"></a>AutoTokenizer</h4><p>AutoTokenizer分词器负责将文本预处理为模型输入的数字数组。有多个规则来规定分词的过程，包括如何拆分一个单词以及以何种级别拆分单词</p>
<p>最重要的是，您<strong>需要使用相同的模型名称来实例化一个分词器，以确保您使用了与预训练模型相同的分词规则</strong></p>
<blockquote>
<p>使用AutoTokenizer加载一个分词器</p>
</blockquote>
<p>将<code>return_tensors</code>参数设置为<code>pt</code>以返回适用于PyTorch的张量，或者设置为<code>tf</code>以返回适用于TensorFlow的张量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer</span><br><span class="line"></span><br><span class="line">model_name = <span class="string">&quot;nlptown/bert-base-multilingual-uncased-sentiment&quot;</span></span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(model_name)</span><br><span class="line">encoding = tokenizer(<span class="string">&quot;We are very happy to show you the 🤗 Transformers library.&quot;</span>, return_tensors=<span class="string">&quot;pt&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;input_ids&#x27;</span>: [<span class="number">101</span>, <span class="number">11312</span>, <span class="number">10320</span>, <span class="number">12495</span>, <span class="number">19308</span>, <span class="number">10114</span>, <span class="number">11391</span>, <span class="number">10855</span>, <span class="number">10103</span>, <span class="number">100</span>, <span class="number">58263</span>, <span class="number">13299</span>, <span class="number">119</span>, <span class="number">102</span>],</span><br><span class="line"> <span class="string">&#x27;token_type_ids&#x27;</span>: [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line"> <span class="string">&#x27;attention_mask&#x27;</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]&#125;</span><br><span class="line"></span><br><span class="line">tokenizer.decode(encoding[<span class="string">&quot;input_ids&quot;</span>])</span><br><span class="line"><span class="string">&quot;We are very happy to show you the 🤗 Transformers library.&quot;</span></span><br></pre></td></tr></table></figure>
<p>分词器返回一个包含三个项目的字典：</p>
<ul>
<li><strong>input_ids</strong>：表示文本中各个标记的数字</li>
<li><strong>token_type_ids</strong>：如果有多个序列，指示一个标记属于哪个序列</li>
<li><strong>attention_mask</strong>：指示一个标记是否应该被掩盖(masked)</li>
</ul>
<p>分词器还可以接受一个输入列表，并对文本进行填充和截断，以返回具有统一长度的批处理数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pt_batch = tokenizer(</span><br><span class="line">    [<span class="string">&quot;We are very happy to show you the 🤗 Transformers library.&quot;</span>, <span class="string">&quot;We hope you don&#x27;t hate it.&quot;</span>],</span><br><span class="line">    padding=<span class="literal">True</span>,</span><br><span class="line">    truncation=<span class="literal">True</span>,</span><br><span class="line">    max_length=<span class="number">512</span>,</span><br><span class="line">    return_tensors=<span class="string">&quot;pt&quot;</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>pad + truncation</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># padding</span></span><br><span class="line">batch_sentences = [</span><br><span class="line">    <span class="string">&quot;But what about second breakfast?&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Don&#x27;t think he knows about second breakfast, Pip.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;What about elevensies?&quot;</span>,</span><br><span class="line">]</span><br><span class="line">encoded_input = tokenizer(batch_sentences, padding=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;input_ids&#x27;</span>: [[<span class="number">101</span>, <span class="number">1252</span>, <span class="number">1184</span>, <span class="number">1164</span>, <span class="number">1248</span>, <span class="number">6462</span>, <span class="number">136</span>, <span class="number">102</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], </span><br><span class="line">               [<span class="number">101</span>, <span class="number">1790</span>, <span class="number">112</span>, <span class="number">189</span>, <span class="number">1341</span>, <span class="number">1119</span>, <span class="number">3520</span>, <span class="number">1164</span>, <span class="number">1248</span>, <span class="number">6462</span>, <span class="number">117</span>, <span class="number">21902</span>, <span class="number">1643</span>, <span class="number">119</span>, <span class="number">102</span>], </span><br><span class="line">               [<span class="number">101</span>, <span class="number">1327</span>, <span class="number">1164</span>, <span class="number">5450</span>, <span class="number">23434</span>, <span class="number">136</span>, <span class="number">102</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]], </span><br><span class="line"> <span class="string">&#x27;token_type_ids&#x27;</span>: [[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], </span><br><span class="line">                    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], </span><br><span class="line">                    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]], </span><br><span class="line"> <span class="string">&#x27;attention_mask&#x27;</span>: [[<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], </span><br><span class="line">                    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>], </span><br><span class="line">                    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># truncation  将truncation参数设置为True，可以将序列截断为模型所能接受的最大长度</span></span><br><span class="line">batch_sentences = [</span><br><span class="line">    <span class="string">&quot;But what about second breakfast?&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Don&#x27;t think he knows about second breakfast, Pip.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;What about elevensies?&quot;</span>,</span><br><span class="line">]</span><br><span class="line">encoded_input = tokenizer(batch_sentences, padding=<span class="literal">True</span>, truncation=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;input_ids&#x27;</span>: [[<span class="number">101</span>, <span class="number">1252</span>, <span class="number">1184</span>, <span class="number">1164</span>, <span class="number">1248</span>, <span class="number">6462</span>, <span class="number">136</span>, <span class="number">102</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], </span><br><span class="line">               [<span class="number">101</span>, <span class="number">1790</span>, <span class="number">112</span>, <span class="number">189</span>, <span class="number">1341</span>, <span class="number">1119</span>, <span class="number">3520</span>, <span class="number">1164</span>, <span class="number">1248</span>, <span class="number">6462</span>, <span class="number">117</span>, <span class="number">21902</span>, <span class="number">1643</span>, <span class="number">119</span>, <span class="number">102</span>], </span><br><span class="line">               [<span class="number">101</span>, <span class="number">1327</span>, <span class="number">1164</span>, <span class="number">5450</span>, <span class="number">23434</span>, <span class="number">136</span>, <span class="number">102</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]], </span><br><span class="line"> <span class="string">&#x27;token_type_ids&#x27;</span>: [[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], </span><br><span class="line">                    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], </span><br><span class="line">                    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]], </span><br><span class="line"> <span class="string">&#x27;attention_mask&#x27;</span>: [[<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], </span><br><span class="line">                    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>], </span><br><span class="line">                    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]]&#125;</span><br></pre></td></tr></table></figure>
<h4 id="AutoModel"><a href="#AutoModel" class="headerlink" title="AutoModel"></a>AutoModel</h4><p>🤗Transformers提供了一种简单而统一的方法来加载预训练模型实例。这意味着您可以像加载AutoTokenizer一样加载AutoModel</p>
<p>唯一的区别是<strong>选择正确的AutoModel来适应任务</strong>。对于文本(或序列)分类，您应该加载AutoModelForSequenceClassification</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoModelForSequenceClassification</span><br><span class="line"></span><br><span class="line">model_name = <span class="string">&quot;nlptown/bert-base-multilingual-uncased-sentiment&quot;</span></span><br><span class="line">pt_model = AutoModelForSequenceClassification.from_pretrained(model_name)</span><br><span class="line"></span><br><span class="line">pt_outputs = pt_model(**pt_batch)</span><br></pre></td></tr></table></figure>
<p>模型将最终的激活值存储在logits属性中。应用softmax函数到logits上以获取概率值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line">pt_predictions = nn.functional.softmax(pt_outputs.logits, dim=-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tensor([[<span class="number">0.0021</span>, <span class="number">0.0018</span>, <span class="number">0.0115</span>, <span class="number">0.2121</span>, <span class="number">0.7725</span>],</span><br><span class="line">        [<span class="number">0.2084</span>, <span class="number">0.1826</span>, <span class="number">0.1969</span>, <span class="number">0.1755</span>, <span class="number">0.2365</span>]], grad_fn=&lt;SoftmaxBackward0&gt;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在huggingface库中，AutoModel类可以根据给定的checkpoint自动选择并加载适合的模型。它支持各种不同的模型架构，包括：</p>
</blockquote>
<ul>
<li>AutoModel: 用于通用的模型加载，根据checkpoint自动选择适合的模型架构</li>
<li>AutoModelForSequenceClassification: 用于序列分类任务的模型，如文本分类</li>
<li>AutoModelForQuestionAnswering: 用于问答任务的模型，如阅读理解</li>
<li>AutoModelForTokenClassification: 用于标记分类任务的模型，如命名实体识别</li>
<li>AutoModelForMaskedLM: 用于遮蔽语言建模任务的模型，如BERT</li>
<li>AutoModelForCausalLM: 用于有因果关系的语言建模任务的模型，如GPT</li>
<li>AutoModelForImageClassification: 用于图像分类任务的模型，如ResNet</li>
<li>AutoModelForImageSegmentation: 用于图像分割任务的模型，如Mask R-CNN</li>
</ul>
<p>这些仅是AutoModel类的一些示例，实际上还有更多可用的模型架构。您可以根据具体的任务需求选择适合的AutoModel类进行加载和使用</p>
<h4 id="其他的Auto类"><a href="#其他的Auto类" class="headerlink" title="其他的Auto类"></a>其他的Auto类</h4><blockquote>
<p>AutoImageProcessor</p>
</blockquote>
<p>对于视觉任务，图像处理器将图像处理为正确的输入格式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoImageProcessor</span><br><span class="line"></span><br><span class="line">image_processor = AutoImageProcessor.from_pretrained(<span class="string">&quot;google/vit-base-patch16-224&quot;</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>AutoFeatureExtractor</p>
</blockquote>
<p>对于音频任务，特征提取器将音频信号处理为正确的输入格式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoFeatureExtractor</span><br><span class="line"></span><br><span class="line">feature_extractor = AutoFeatureExtractor.from_pretrained(</span><br><span class="line">    <span class="string">&quot;ehcalabres/wav2vec2-lg-xlsr-en-speech-emotion-recognition&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>AutoProcessor</p>
</blockquote>
<p>多模态任务需要一个处理器来结合两种类型的预处理工具。例如，LayoutLMV2模型需要一个图像处理器来处理图像，还需要一个分词器来处理文本；处理器将两者结合起来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoProcessor</span><br><span class="line"></span><br><span class="line">processor = AutoProcessor.from_pretrained(<span class="string">&quot;microsoft/layoutlmv2-base-uncased&quot;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="模型保存"><a href="#模型保存" class="headerlink" title="模型保存"></a>模型保存</h4><p>一旦您的模型经过微调，您可以使用PreTrainedModel.save_pretrained()将其与其标记器一起保存起来：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 模型+分词器 保存</span></span><br><span class="line">pt_save_directory = <span class="string">&quot;./pt_save_pretrained&quot;</span></span><br><span class="line">tokenizer.save_pretrained(pt_save_directory)</span><br><span class="line">pt_model.save_pretrained(pt_save_directory)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载</span></span><br><span class="line">pt_model = AutoModelForSequenceClassification.from_pretrained(pt_save_directory)</span><br></pre></td></tr></table></figure>
<h3 id="AutoConfig"><a href="#AutoConfig" class="headerlink" title="AutoConfig"></a>AutoConfig</h3><p>您可以修改模型的<strong>配置类</strong>来更改模型的构建方式。配置类指定了模型的属性，例如隐藏层的数量或注意力头数</p>
<p>当您从自定义配置类初始化模型时，您将从头开始。模型的属性将被随机初始化，您需要在使用模型之前对其进行训练以获得有意义的结果</p>
<p>首先导入AutoConfig，然后加载要修改的预训练模型。在AutoConfig.from_pretrained()中，您可以指定要更改的属性，例如注意力头的数量：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoConfig</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoModel</span><br><span class="line"></span><br><span class="line">my_config = AutoConfig.from_pretrained(<span class="string">&quot;distilbert-base-uncased&quot;</span>, n_heads=<span class="number">12</span>)</span><br><span class="line">my_model = AutoModel.from_config(my_config)</span><br></pre></td></tr></table></figure>
<h3 id="Trainer"><a href="#Trainer" class="headerlink" title="Trainer"></a>Trainer</h3><p>对于PyTorch，所有模型都是标准的torch.nn.Module，因此您可以在任何典型的训练循环中使用它们。虽然您可以编写自己的训练循环，但🤗Transformers提供了<code>Trainer</code>类，其中包含基本的训练循环，并添加了其他功能，如分布式训练、混合精度等</p>
<p>根据您的任务，通常会向Trainer传递以下参数：</p>
<ol>
<li><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://huggingface.co/docs/transformers/v4.30.0/en/main_classes/model#transformers.PreTrainedModel">PreTrainedModel</a>或<a target="_blank" rel="noopener external nofollow noreferrer" href="https://pytorch.org/docs/stable/nn.html#torch.nn.Module"><code>torch.nn.Module</code></a>对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoModelForSequenceClassification</span><br><span class="line"></span><br><span class="line">model = AutoModelForSequenceClassification.from_pretrained(<span class="string">&quot;distilbert-base-uncased&quot;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>TrainingArguments</strong>包含了可以修改的模型超参数，比如学习率、批大小和训练的轮数。如果你不指定任何训练参数，将使用默认值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> TrainingArguments</span><br><span class="line"></span><br><span class="line">training_args = TrainingArguments(</span><br><span class="line">    output_dir=<span class="string">&quot;path/to/save/folder/&quot;</span>,</span><br><span class="line">    learning_rate=<span class="number">2e-5</span>,</span><br><span class="line">    per_device_train_batch_size=<span class="number">8</span>,</span><br><span class="line">    per_device_eval_batch_size=<span class="number">8</span>,</span><br><span class="line">    num_train_epochs=<span class="number">2</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Preprocessing</strong>类，例如tokenizer(标记器)、image processor(图像处理器)、feature extractor(特征提取器)或processor(处理器)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer</span><br><span class="line"></span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(<span class="string">&quot;distilbert-base-uncased&quot;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>加载数据集</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;rotten_tomatoes&quot;</span>)  <span class="comment"># doctest: +IGNORE_RESULT</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建一个函数来对数据集进行<strong>标记化</strong>处理，然后使用<code>map</code>函数将其应用于整个数据集</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">tokenize_dataset</span>(<span class="params">dataset</span>):</span><br><span class="line">    <span class="keyword">return</span> tokenizer(dataset[<span class="string">&quot;text&quot;</span>])</span><br><span class="line"></span><br><span class="line">dataset = dataset.<span class="built_in">map</span>(tokenize_dataset, batched=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用<code>DataCollatorWithPadding</code>来从数据集中创建一个批次的示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> DataCollatorWithPadding</span><br><span class="line"></span><br><span class="line">data_collator = DataCollatorWithPadding(tokenizer=tokenizer)</span><br></pre></td></tr></table></figure>
<p><code>DataCollatorWithPadding</code>是Hugging Face的<code>transformers</code>库中的一个类，用于在训练过程中创建批次数据。它的作用是将不同长度的样本填充到相同长度，以便能够同时进行批处理</p>
<p>具体来说，<code>DataCollatorWithPadding</code>会根据给定的数据集，找到其中最长的样本，并将其他样本填充到相同的长度。填充通常使用特定的填充令牌(token)来完成，这样模型在处理时可以识别出填充部分，并进行相应的处理</p>
<p>使用<code>DataCollatorWithPadding</code>可以确保批次数据的长度一致，从而提高训练效率，并避免由于不同长度样本导致的错误</p>
</li>
</ol>
<p>现在将所有这些类组合在Trainer中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> Trainer</span><br><span class="line"></span><br><span class="line">trainer = Trainer(</span><br><span class="line">    model=model,</span><br><span class="line">    args=training_args,</span><br><span class="line">    train_dataset=dataset[<span class="string">&quot;train&quot;</span>],</span><br><span class="line">    eval_dataset=dataset[<span class="string">&quot;test&quot;</span>],</span><br><span class="line">    tokenizer=tokenizer,</span><br><span class="line">    data_collator=data_collator,</span><br><span class="line">)  <span class="comment"># doctest: +SKIP</span></span><br><span class="line"></span><br><span class="line">trainer.train()</span><br></pre></td></tr></table></figure>
<p>Trainer类提供了自定义训练循环行为的方法，你可以通过继承Trainer类并重写其中的方法来实现自定义行为。这样你就可以定制诸如损失函数、优化器和学习率调度器等功能。你可以参考Trainer类的文档了解可以重写的方法</p>
<p>另一种定制训练循环的方式是使用回调函数(Callbacks)。你可以使用回调函数与其他库进行集成，监视训练过程并报告进展，或在必要时提前停止训练。回调函数不会修改训练循环本身的行为。如果你需要定制损失函数等内容，你需要继承Trainer类来实现</p>
<h1 id="教程"><a href="#教程" class="headerlink" title="教程"></a>教程</h1><h2 id="模型训练"><a href="#模型训练" class="headerlink" title="模型训练"></a>模型训练</h2><p>使用预训练模型有很多好处。它可以减少计算成本和碳足迹，并且可以让您使用最先进的模型，而无需从头开始训练</p>
<p>🤗Transformers提供了对各种任务的数千个预训练模型的访问。当您使用预训练模型时，您可以在特定于您任务的数据集上进行微调训练。这被称为<code>微调</code>，是一种非常强大的训练技术</p>
<blockquote>
<p>数据准备</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 加载数据集</span></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;yelp_review_full&quot;</span>)</span><br><span class="line">dataset[<span class="string">&quot;train&quot;</span>][<span class="number">100</span>]</span><br><span class="line">&#123;<span class="string">&#x27;label&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"> <span class="string">&#x27;text&#x27;</span>: <span class="string">&#x27;My expectations for McDonalds are t rarely high. But for one to still fail so spectacularly...that takes something special!\\nThe cashier took my friends\&#x27;s order, then promptly ignored me. I had to force myself in front of a cashier who opened his register to wait on the person BEHIND me. I waited over five minutes for a gigantic order that included precisely one kid\&#x27;s meal. After watching two people who ordered after me be handed their food, I asked where mine was. The manager started yelling at the cashiers for \\&quot;serving off their orders\\&quot; when they didn\&#x27;t have their food. But neither cashier was anywhere near those controls, and the manager was the one serving food to customers and clearing the boards.\\nThe manager was rude when giving me my order. She didn\&#x27;t make sure that I had everything ON MY RECEIPT, and never even had the decency to apologize that I felt I was getting poor service.\\nI\&#x27;ve eaten at various McDonalds restaurants for over 30 years. I\&#x27;ve worked at more than one location. I expect bad days, bad moods, and the occasional mistake. But I have yet to have a decent experience at this store. It will remain a place I avoid unless someone in my party needs to avoid illness from low blood sugar. Perhaps I should go back to the racially biased service of Steak n Shake instead!&#x27;</span>&#125;</span><br><span class="line"><span class="comment"># 可以创建一个较小的数据集子集，用于微调，以减少所需的时间</span></span><br><span class="line">small_train_dataset = tokenized_datasets[<span class="string">&quot;train&quot;</span>].shuffle(seed=<span class="number">42</span>).select(<span class="built_in">range</span>(<span class="number">1000</span>))</span><br><span class="line">small_eval_dataset = tokenized_datasets[<span class="string">&quot;test&quot;</span>].shuffle(seed=<span class="number">42</span>).select(<span class="built_in">range</span>(<span class="number">1000</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 分词器</span></span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(<span class="string">&quot;bert-base-cased&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tokenize_function</span>(<span class="params">examples</span>):</span><br><span class="line">    <span class="keyword">return</span> tokenizer(examples[<span class="string">&quot;text&quot;</span>], padding=<span class="string">&quot;max_length&quot;</span>, truncation=<span class="literal">True</span>)</span><br><span class="line">tokenized_datasets = dataset.<span class="built_in">map</span>(tokenize_function, batched=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Train with PyTorch Trainer</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoModelForSequenceClassification</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> TrainingArguments</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> evaluate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 加载模型</span></span><br><span class="line">model = AutoModelForSequenceClassification.from_pretrained(<span class="string">&quot;bert-base-cased&quot;</span>, num_labels=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 定义训练参数  在训练参数中指定evaluation_strategy参数，以在每个epoch结束时报告评估指标</span></span><br><span class="line">training_args = TrainingArguments(output_dir=<span class="string">&quot;test_trainer&quot;</span>, evaluation_strategy=<span class="string">&quot;epoch&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 加载评估器</span></span><br><span class="line">metric = evaluate.load(<span class="string">&quot;accuracy&quot;</span>)</span><br><span class="line"><span class="comment"># 在计算度量标准的时候调用compute，以计算您的预测的准确率。在将预测结果传递给compute之前，您需要将预测结果转换为logits</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compute_metrics</span>(<span class="params">eval_pred</span>):</span><br><span class="line">    logits, labels = eval_pred</span><br><span class="line">    predictions = np.argmax(logits, axis=-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> metric.compute(predictions=predictions, references=labels)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 定义Trainer</span></span><br><span class="line">trainer = Trainer(</span><br><span class="line">    model=model,</span><br><span class="line">    args=training_args,</span><br><span class="line">    train_dataset=small_train_dataset,</span><br><span class="line">    eval_dataset=small_eval_dataset,</span><br><span class="line">    compute_metrics=compute_metrics,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 开始训练</span></span><br><span class="line">trainer.train()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Train in native PyTorch</p>
</blockquote>
<p>Trainer负责训练循环，并允许您通过一行代码对模型进行微调。对于喜欢编写自己的训练循环的用户，您也可以在原生PyTorch中对🤗Transformers模型进行微调</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoModelForSequenceClassification</span><br><span class="line"><span class="keyword">from</span> torch.optim <span class="keyword">import</span> AdamW</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> get_scheduler</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> tqdm.auto <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> evaluate</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 数据集预处理</span></span><br><span class="line">tokenized_datasets = tokenized_datasets.remove_columns([<span class="string">&quot;text&quot;</span>])</span><br><span class="line">tokenized_datasets = tokenized_datasets.rename_column(<span class="string">&quot;label&quot;</span>, <span class="string">&quot;labels&quot;</span>)</span><br><span class="line">tokenized_datasets.set_format(<span class="string">&quot;torch&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 定义DataLoader</span></span><br><span class="line">train_dataloader = DataLoader(small_train_dataset, shuffle=<span class="literal">True</span>, batch_size=<span class="number">8</span>)</span><br><span class="line">eval_dataloader = DataLoader(small_eval_dataset, batch_size=<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 加载模型</span></span><br><span class="line">model = AutoModelForSequenceClassification.from_pretrained(<span class="string">&quot;bert-base-cased&quot;</span>, num_labels=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 定义优化器</span></span><br><span class="line">optimizer = AdamW(model.parameters(), lr=<span class="number">5e-5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 定义scheduler</span></span><br><span class="line">num_epochs = <span class="number">3</span></span><br><span class="line">num_training_steps = num_epochs * <span class="built_in">len</span>(train_dataloader)</span><br><span class="line">lr_scheduler = get_scheduler(</span><br><span class="line">    name=<span class="string">&quot;linear&quot;</span>, optimizer=optimizer, num_warmup_steps=<span class="number">0</span>, num_training_steps=num_training_steps</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 移动模型到指定设备 </span></span><br><span class="line">device = torch.device(<span class="string">&quot;cuda&quot;</span>) <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> torch.device(<span class="string">&quot;cpu&quot;</span>)</span><br><span class="line">model.to(device)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. 开始训练</span></span><br><span class="line">progress_bar = tqdm(<span class="built_in">range</span>(num_training_steps))</span><br><span class="line">model.train()</span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">    <span class="keyword">for</span> batch <span class="keyword">in</span> train_dataloader:</span><br><span class="line">        batch = &#123;k: v.to(device) <span class="keyword">for</span> k, v <span class="keyword">in</span> batch.items()&#125;</span><br><span class="line">        outputs = model(**batch)</span><br><span class="line">        loss = outputs.loss</span><br><span class="line">        loss.backward()</span><br><span class="line"></span><br><span class="line">        optimizer.step()</span><br><span class="line">        lr_scheduler.step()</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        progress_bar.update(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8. 验证集评估</span></span><br><span class="line">metric = evaluate.load(<span class="string">&quot;accuracy&quot;</span>)</span><br><span class="line">model.<span class="built_in">eval</span>()</span><br><span class="line"><span class="keyword">for</span> batch <span class="keyword">in</span> eval_dataloader:</span><br><span class="line">    batch = &#123;k: v.to(device) <span class="keyword">for</span> k, v <span class="keyword">in</span> batch.items()&#125;</span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        outputs = model(**batch)</span><br><span class="line"></span><br><span class="line">    logits = outputs.logits</span><br><span class="line">    predictions = torch.argmax(logits, dim=-<span class="number">1</span>)</span><br><span class="line">    metric.add_batch(predictions=predictions, references=batch[<span class="string">&quot;labels&quot;</span>])</span><br><span class="line"></span><br><span class="line">metric.compute()</span><br></pre></td></tr></table></figure>
<h2 id="分布式加速"><a href="#分布式加速" class="headerlink" title="分布式加速"></a>分布式加速</h2><blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://huggingface.co/docs/accelerate/quicktour">huggingface的accelerate模块</a></p>
</blockquote>
<p>🤗Accelerate是Hugging Face提供的用于简化分布式训练的库。它旨在使分布式训练更加容易和高效，支持多种深度学习框架，包括PyTorch和TensorFlow</p>
<p>Accelerate提供了以下功能：</p>
<ol>
<li><strong>数据并行</strong>：Accelerate使用<code>accelerator.DataParallel</code>类来实现数据并行，可以在多个GPU上同时训练模型</li>
<li><strong>混合精度训练</strong>：Accelerate支持自动混合精度训练，通过将模型参数和梯度转换为半精度浮点数来减少内存占用和计算量</li>
<li><strong>分布式训练</strong>：Accelerate使用<code>accelerator.DistributedDataParallel</code>类来实现分布式训练，可以在多个机器上并行训练模型</li>
<li>训练循环的自动管理：Accelerate提供了一个<code>accelerator.Trainer</code>类，它封装了训练循环，自动处理数据加载、前向传播、反向传播、优化器更新等过程</li>
</ol>
<p>使用Accelerate可以简化分布式训练的配置和管理，使用户能够更轻松地利用多个GPU或多台机器进行训练，并获得更高的训练效率</p>
<blockquote>
<p>安装</p>
</blockquote>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install accelerate</span><br></pre></td></tr></table></figure>
<blockquote>
<p>示例代码，以下代码只列出改变的部分代码</p>
</blockquote>
<p>只需要在训练循环中添加四行额外的代码即可启用分布式训练</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> accelerate <span class="keyword">import</span> Accelerator</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 定义加速器</span></span><br><span class="line">accelerator = Accelerator()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. dataloader包装</span></span><br><span class="line">train_dataloader, eval_dataloader, model, optimizer = accelerator.prepare(</span><br><span class="line">    train_dataloader, eval_dataloader, model, optimizer</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 反向传播</span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">    <span class="keyword">for</span> batch <span class="keyword">in</span> train_dataloader:</span><br><span class="line">        outputs = model(**batch)</span><br><span class="line">        loss = outputs.loss</span><br><span class="line">        accelerator.backward(loss)</span><br><span class="line"></span><br><span class="line">        optimizer.step()</span><br><span class="line">        lr_scheduler.step()</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        progress_bar.update(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>完整代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="keyword">from</span> accelerate <span class="keyword">import</span> Accelerator</span><br><span class="line">  <span class="keyword">from</span> transformers <span class="keyword">import</span> AdamW, AutoModelForSequenceClassification, get_scheduler</span><br><span class="line"></span><br><span class="line">+ accelerator = Accelerator()</span><br><span class="line"></span><br><span class="line">  model = AutoModelForSequenceClassification.from_pretrained(checkpoint, num_labels=<span class="number">2</span>)</span><br><span class="line">  optimizer = AdamW(model.parameters(), lr=<span class="number">3e-5</span>)</span><br><span class="line"></span><br><span class="line">- device = torch.device(<span class="string">&quot;cuda&quot;</span>) <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> torch.device(<span class="string">&quot;cpu&quot;</span>)</span><br><span class="line">- model.to(device)</span><br><span class="line"></span><br><span class="line">+ train_dataloader, eval_dataloader, model, optimizer = accelerator.prepare(</span><br><span class="line">+     train_dataloader, eval_dataloader, model, optimizer</span><br><span class="line">+ )</span><br><span class="line"></span><br><span class="line">  num_epochs = <span class="number">3</span></span><br><span class="line">  num_training_steps = num_epochs * <span class="built_in">len</span>(train_dataloader)</span><br><span class="line">  lr_scheduler = get_scheduler(</span><br><span class="line">      <span class="string">&quot;linear&quot;</span>,</span><br><span class="line">      optimizer=optimizer,</span><br><span class="line">      num_warmup_steps=<span class="number">0</span>,</span><br><span class="line">      num_training_steps=num_training_steps</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  progress_bar = tqdm(<span class="built_in">range</span>(num_training_steps))</span><br><span class="line"></span><br><span class="line">  model.train()</span><br><span class="line">  <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">      <span class="keyword">for</span> batch <span class="keyword">in</span> train_dataloader:</span><br><span class="line">-         batch = &#123;k: v.to(device) <span class="keyword">for</span> k, v <span class="keyword">in</span> batch.items()&#125;</span><br><span class="line">          outputs = model(**batch)</span><br><span class="line">          loss = outputs.loss</span><br><span class="line">-         loss.backward()</span><br><span class="line">+         accelerator.backward(loss)</span><br><span class="line"></span><br><span class="line">          optimizer.step()</span><br><span class="line">          lr_scheduler.step()</span><br><span class="line">          optimizer.zero_grad()</span><br><span class="line">          progress_bar.update(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h2 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h2><p>包括<a target="_blank" rel="noopener external nofollow noreferrer" href="https://huggingface.co/docs/transformers/v4.30.0/en/tasks/sequence_classification">自然语言处理</a>、<a target="_blank" rel="noopener external nofollow noreferrer" href="https://huggingface.co/docs/transformers/v4.30.0/en/tasks/audio_classification">语音</a>、<a target="_blank" rel="noopener external nofollow noreferrer" href="https://huggingface.co/docs/transformers/v4.30.0/en/tasks/image_classification">计算机视觉</a>和<a target="_blank" rel="noopener external nofollow noreferrer" href="https://huggingface.co/docs/transformers/v4.30.0/en/tasks/image_captioning">多模态</a></p>
<h1 id="PEFT模块"><a href="#PEFT模块" class="headerlink" title="PEFT模块"></a>PEFT模块</h1><blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://huggingface.co/docs/peft/index#supported-models">huggingface PEFT模块</a></p>
</blockquote>
<p>🤗<code>PEFT</code>，即<strong>Parameter-Efficient Fine-Tuning(参数高效微调)</strong>，是一个用于高效地将预训练语言模型(PLM)适应于各种下游应用的库，而无需对所有模型参数进行微调</p>
<p>PEFT方法只微调少量的(额外的)模型参数，显著降低了计算和存储成本，因为对大规模PLM进行完整微调代价过高。最近的最先进的PEFT技术达到了与完整微调相当的性能</p>
<p>PEFT与🤗Accelerate库无缝集成，用于利用DeepSpeed和Big Model Inference进行大规模模型微调</p>
<blockquote>
<p>Supported methods (截至23-06-15)</p>
</blockquote>
<ol>
<li>LoRA: <a target="_blank" rel="noopener external nofollow noreferrer" href="https://arxiv.org/pdf/2106.09685.pdf">LORA: LOW-RANK ADAPTATION OF LARGE LANGUAGE MODELS</a></li>
<li>Prefix Tuning: <a target="_blank" rel="noopener external nofollow noreferrer" href="https://aclanthology.org/2021.acl-long.353/">Prefix-Tuning: Optimizing Continuous Prompts for Generation</a>, <a target="_blank" rel="noopener external nofollow noreferrer" href="https://arxiv.org/pdf/2110.07602.pdf">P-Tuning v2: Prompt Tuning Can Be Comparable to Fine-tuning Universally Across Scales and Tasks</a></li>
<li>P-Tuning: <a target="_blank" rel="noopener external nofollow noreferrer" href="https://arxiv.org/pdf/2103.10385.pdf">GPT Understands, Too</a></li>
<li>Prompt Tuning: <a target="_blank" rel="noopener external nofollow noreferrer" href="https://arxiv.org/pdf/2104.08691.pdf">The Power of Scale for Parameter-Efficient Prompt Tuning</a></li>
<li>AdaLoRA: <a target="_blank" rel="noopener external nofollow noreferrer" href="https://arxiv.org/abs/2303.10512">Adaptive Budget Allocation for Parameter-Efficient Fine-Tuning</a></li>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/ZrrSkywalker/LLaMA-Adapter">LLaMA-Adapter: Efficient Fine-tuning of Language Models with Zero-init Attention</a></li>
</ol>
<h1 id="其他模块"><a href="#其他模块" class="headerlink" title="其他模块"></a>其他模块</h1><h2 id="AutoTrain"><a href="#AutoTrain" class="headerlink" title="AutoTrain"></a>AutoTrain</h2><p><code>AutoTrain</code>是一个用于自动化训练的库，旨在简化模型训练的过程。它提供了一种简单的方法来定义和训练深度学习模型，自动处理数据加载、批处理、优化器、损失函数等训练过程中的细节。通过使用AutoTrain，你可以更快速地搭建和训练模型，减少样板代码的编写，并且能够轻松地进行超参数搜索和模型选择</p>
<h2 id="Gradio"><a href="#Gradio" class="headerlink" title="Gradio"></a>Gradio</h2><p><code>Gradio</code>是一个用于构建交互式界面的库，使你能够轻松地为你的深度学习模型创建Web应用程序。Gradio提供了一个简单而强大的API，可以将模型与用户界面组件(如文本框、滑块、图像上传器等)相连接，从而实现模型的实时推理和可视化。通过Gradio，你可以快速构建一个交互式的演示或部署你的模型到Web上，无需编写复杂的前端代码</p>
<h2 id="Diffusers"><a href="#Diffusers" class="headerlink" title="Diffusers"></a>Diffusers</h2><p><code>Diffusers</code>是一个用于生成图像、音频甚至分子的三维结构的最新预训练扩散模型的库。无论您是寻找一个简单的推理解决方案，还是想要训练自己的扩散模型，🤗Diffusers都是一个支持两者的模块化工具箱。我们的库着重于易用性而非性能，简洁而非复杂，可定制性而非抽象性，该库主要包含以下三个组件：</p>
<ol>
<li>最新的扩散推理流程，只需几行代码即可实现</li>
<li>可互换的噪声调度器，用于在生成速度和质量之间平衡权衡</li>
<li>可用作构建块的预训练模型，可以与调度器结合使用，创建您自己的端到端扩散系统</li>
</ol>
<h2 id="Accelerate"><a href="#Accelerate" class="headerlink" title="Accelerate"></a>Accelerate</h2><p>Hugging Face的<code>Accelerate</code>是一个旨在简化和加速深度学习模型训练和推理过程的库</p>
<p>它提供了一个高级API，抽象了分布式训练、混合精度和梯度累积等复杂性，使用户能够轻松地充分利用硬件资源的潜力</p>
<p>Accelerate兼容PyTorch和TensorFlow，并提供了一套工具和实用程序，以实现跨多个GPU或多台机器的高效分布式训练。它包括以下功能：</p>
<ol>
<li><strong>分布式训练</strong>：Accelerate提供了简单易用的接口，使用户能够将训练过程分布到多个GPU或多台机器上。它支持常见的分布式训练策略，如数据并行和模型并行，并自动处理数据的分发和梯度的聚合，使用户无需手动编写复杂的分布式训练代码</li>
<li><strong>混合精度训练</strong>：Accelerate支持混合精度训练，通过同时使用浮点16位和浮点32位精度来加快模型的训练速度。它自动处理数据类型转换和梯度缩放，用户只需简单地指定使用混合精度训练即可</li>
<li><strong>梯度累积</strong>：Accelerate支持梯度累积，这在GPU显存有限的情况下特别有用。梯度累积允许在多个小批次上累积梯度，然后进行一次大批次的参数更新，从而减少显存占用并提高训练效率</li>
<li><strong>自动调节批次大小</strong>：Accelerate可以自动调整批次大小以适应可用的GPU内存。它会动态调整批次大小，以达到最佳的GPU利用率和训练性能</li>
</ol>
<p>总之，Hugging Face的Accelerate是一个功能强大的库，旨在简化和加速深度学习模型的训练和推理过程。它提供了高级API和一系列工具，使用户能够轻松地实现分布式训练、混合精度训练和梯度累积等高效训练策略</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/narutohyc">narutohyc</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://study.hycbook.com/article/57912.html">https://study.hycbook.com/article/57912.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://study.hycbook.com" target="_blank">兼一书虫</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/huggingface/">huggingface</a><a class="post-meta__tags" href="/tags/transformers/">transformers</a></div><div class="post_share"><div class="social-share" data-image="https://pic.hycbook.com/i/hexo/post_cover/蕾姆0.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><link rel="stylesheet" href="/" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">打赏</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://pic.hycbook.com/i//hexo/qr_codes/hyc_wechat.webp" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.hycbook.com/i//hexo/qr_codes/hyc_wechat.webp" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://pic.hycbook.com/i//hexo/qr_codes/hyc_alipay.webp" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.hycbook.com/i//hexo/qr_codes/hyc_alipay.webp" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></button></div><audio id="coinAudio" src="https://s1.vika.cn/space/2022/10/29/6db0ad2bccf949f09054b3b206dcc66f?attname=马里奥游戏投币叮当.mp3"></audio><script defer="defer" src="/"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/article/53377.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.hycbook.com/i/hexo/post_cover/蕾姆11.webp" onerror="onerror=null;src='https://pic.hycbook.com/i/hexo/config_imgs/404.svg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">深度学习模型压缩技术</div></div></a></div><div class="next-post pull-right"><a href="/article/24897.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.hycbook.com/i/hexo/post_cover/蕾姆12.webp" onerror="onerror=null;src='https://pic.hycbook.com/i/hexo/config_imgs/404.svg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">LLM模型部署调试推理</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Twikoo</span><span class="switch-btn"></span><span class="second-comment">Valine</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#huggingface"><span class="toc-number">1.</span> <span class="toc-text">huggingface</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.</span> <span class="toc-text">安装</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#datasets"><span class="toc-number">2.</span> <span class="toc-text">datasets</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-1"><span class="toc-number">2.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B"><span class="toc-number">2.2.</span> <span class="toc-text">快速开始</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E8%A7%89"><span class="toc-number">2.2.1.</span> <span class="toc-text">视觉</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nlp"><span class="toc-number">2.2.2.</span> <span class="toc-text">nlp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">2.3.</span> <span class="toc-text">加载数据集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">2.4.</span> <span class="toc-text">进阶加载数据集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A2%E7%B4%A2%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">2.5.</span> <span class="toc-text">探索数据集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Preprocess%E5%A4%84%E7%90%86"><span class="toc-number">2.6.</span> <span class="toc-text">Preprocess处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">2.7.</span> <span class="toc-text">构建数据集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E4%BA%AB%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">2.8.</span> <span class="toc-text">分享数据集</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%84%E4%BC%B0%E6%8C%87%E6%A0%87"><span class="toc-number">3.</span> <span class="toc-text">评估指标</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-2"><span class="toc-number">3.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B-1"><span class="toc-number">3.2.</span> <span class="toc-text">快速开始</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E6%A0%87%E7%A7%8D%E7%B1%BB"><span class="toc-number">3.2.1.</span> <span class="toc-text">指标种类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E6%A0%87%E5%8A%A0%E8%BD%BD"><span class="toc-number">3.2.2.</span> <span class="toc-text">指标加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E6%A0%87%E8%AE%A1%E7%AE%97"><span class="toc-number">3.2.3.</span> <span class="toc-text">指标计算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C%E5%AD%98%E5%82%A8"><span class="toc-number">3.2.4.</span> <span class="toc-text">结果存储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">3.2.5.</span> <span class="toc-text">可视化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E6%8C%87%E6%A0%87"><span class="toc-number">3.2.6.</span> <span class="toc-text">选择合适指标</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#transformers"><span class="toc-number">4.</span> <span class="toc-text">transformers</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-1"><span class="toc-number">4.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-3"><span class="toc-number">4.2.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B-2"><span class="toc-number">4.3.</span> <span class="toc-text">快速开始</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pipeline"><span class="toc-number">4.3.1.</span> <span class="toc-text">Pipeline</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AutoClass"><span class="toc-number">4.3.2.</span> <span class="toc-text">AutoClass</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AutoTokenizer"><span class="toc-number">4.3.2.1.</span> <span class="toc-text">AutoTokenizer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AutoModel"><span class="toc-number">4.3.2.2.</span> <span class="toc-text">AutoModel</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%9A%84Auto%E7%B1%BB"><span class="toc-number">4.3.2.3.</span> <span class="toc-text">其他的Auto类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E4%BF%9D%E5%AD%98"><span class="toc-number">4.3.2.4.</span> <span class="toc-text">模型保存</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AutoConfig"><span class="toc-number">4.3.3.</span> <span class="toc-text">AutoConfig</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trainer"><span class="toc-number">4.3.4.</span> <span class="toc-text">Trainer</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%99%E7%A8%8B"><span class="toc-number">5.</span> <span class="toc-text">教程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83"><span class="toc-number">5.1.</span> <span class="toc-text">模型训练</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E5%8A%A0%E9%80%9F"><span class="toc-number">5.2.</span> <span class="toc-text">分布式加速</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="toc-number">5.3.</span> <span class="toc-text">示例代码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PEFT%E6%A8%A1%E5%9D%97"><span class="toc-number">6.</span> <span class="toc-text">PEFT模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%A8%A1%E5%9D%97"><span class="toc-number">7.</span> <span class="toc-text">其他模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#AutoTrain"><span class="toc-number">7.1.</span> <span class="toc-text">AutoTrain</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gradio"><span class="toc-number">7.2.</span> <span class="toc-text">Gradio</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Diffusers"><span class="toc-number">7.3.</span> <span class="toc-text">Diffusers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Accelerate"><span class="toc-number">7.4.</span> <span class="toc-text">Accelerate</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://pic.hycbook.com/i/hexo/config_imgs/footer_bg.webp')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By narutohyc</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><p><a target="_blank" href="https://hexo.io/" rel="external nofollow noreferrer"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为Hexo"></a>&nbsp;<a target="_blank" href="https://demo.jerryc.me/" rel="external nofollow noreferrer"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用butterfly"></a>&nbsp;<a target="_blank" href="https://vercel.com/ " rel="external nofollow noreferrer"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-Vervel-brightgreen?style=flat&logo=Vercel" title="本站采用双线部署，默认线路托管于Vercel"></a>&nbsp;<a target="_blank" href="https://github.com/" rel="external nofollow noreferrer"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由Gtihub托管"></a>&nbsp;<a target="_blank" href="https://zixiaoyun.com" rel="external nofollow noreferrer"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/图床-薄荷图床-green" title="薄荷图床"></a></p><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=35020502000647" rel="external nofollow noreferrer"><img style="position:relative;top:4px" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.hycbook.com/i//hexo/config_imgs//备案图标.webp" alt="ICP"/>闽公网安备35020502000647号  </a><a href="https://beian.miit.gov.cn/" rel="external nofollow noreferrer" target="_blank">闽ICP备2022013843号-1</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="fa-solid fa-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="fa-solid fa-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="fa-solid fa-arrow-rotate-right"></i></div><div class="rightMenu-item" id="menu-home"><i class="fa-solid fa-house"></i></div></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();" rel="external nofollow noreferrer"><i class="fas fa-comment"></i><span>百度搜索</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" href="/archives/"><i class="fa-solid fa-archive"></i><span>文章归档</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="fa-solid fa-folder-open"></i><span>文章分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="fa-solid fa-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuNormal"><a class="rightMenu-item menu-link" id="menu-radompage"><i class="fa-solid fa-shoe-prints"></i><span>随便逛逛</span></a><div class="rightMenu-item" id="menu-translate"><i class="fa-solid fa-earth-asia"></i><span>繁简切换</span></div><div class="rightMenu-item" id="menu-darkmode"><i class="fa-solid fa-moon"></i><span>切换模式</span></div></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? '' : ''

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://vercel.hycbook.com',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://vercel.hycbook.com',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'ncn88uooQf0IO2rrGE7Vniwp-gzGzoHsz',
      appKey: 'Yghpzg1QfBMFJ0MxxHubVzKL',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: true
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Twikoo' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://vercel.hycbook.com',
        region: '',
        pageSize: 3,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/rightMenu.js"></script><script defer data-pjax src="/js/udf_mouse.js"></script><script defer data-pjax src="/js/udf_js.js"></script><script defer data-pjax src="/zhheo/random.js"></script><script data-pjax src="/js/coin.js"></script><script defer src="https://npm.elemecdn.com/vue@2.6.11"></script><script async src="//at.alicdn.com/t/c/font_3670467_a0sijt8frxo.js"></script><script defer src="/live2d-widget/autoload.js"></script><script defer src="/js/udf_js.js"></script><script defer src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="true"></script><script>window.$crisp = [];
window.CRISP_WEBSITE_ID = "561b80db-3f0f-45cb-b3b1-aae7355939e6";
(function () {
  d = document;
  s = d.createElement("script");
  s.src = "https://client.crisp.chat/l.js";
  s.async = 1;
  d.getElementsByTagName("head")[0].appendChild(s);
})();
$crisp.push(["safe", true])

if (false) {
  $crisp.push(["do", "chat:hide"])
  $crisp.push(["on", "chat:closed", function() {
    $crisp.push(["do", "chat:hide"])
  }])
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      $crisp.push(["do", "chat:show"])
      $crisp.push(["do", "chat:open"])

    });
  }
  chatBtnFn()
} else {
  if (false) {
    function chatBtnHide () {
      $crisp.push(["do", "chat:hide"])
    }
    function chatBtnShow () {
      $crisp.push(["do", "chat:show"])
    }
  }
}</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="app-refresh" id="app-refresh" style="position: fixed;top: -2.2rem;left: 0;right: 0;z-index: 99999;padding: 0 1rem;font-size: 15px;height: 2.2rem;transition: all 0.3s ease;"><div class="app-refresh-wrap" style=" display: flex;color: #fff;height: 100%;align-items: center;justify-content: center;"><label>✨ 兼一书虫上新啦！ 👉</label><a href="javascript:void(0)" rel="external nofollow noreferrer" onclick="location.reload()"><span style="color: #fff;text-decoration: underline;cursor: pointer;">🍭查看新品🍬</span></a></div></div><script>if ('serviceWorker' in navigator) {
  if (navigator.serviceWorker.controller) {
    navigator.serviceWorker.addEventListener('controllerchange', function() {
      showNotification()
    })
  }
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/sw.js')
  })
}

function showNotification() {
  if (GLOBAL_CONFIG.Snackbar) {
    var snackbarBg =
      document.documentElement.getAttribute('data-theme') === 'light' ?
      GLOBAL_CONFIG.Snackbar.bgLight :
      GLOBAL_CONFIG.Snackbar.bgDark
    var snackbarPos = GLOBAL_CONFIG.Snackbar.position
    Snackbar.show({
      text: '✨ 兼一书虫上新啦！ 👉',
      backgroundColor: snackbarBg,
      duration: 500000,
      pos: snackbarPos,
      actionText: '🍭查看新品🍬',
      actionTextColor: '#fff',
      onActionClick: function(e) {
        location.reload()
      },
    })
  } else {
    var showBg =
      document.documentElement.getAttribute('data-theme') === 'light' ?
      '#49b1f5' :
      '#1f1f1f'
    var cssText = `top: 0; background: ${showBg};`
    document.getElementById('app-refresh')
      .style.cssText = cssText
  }
}</script></div><!-- hexo injector body_end start --><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>